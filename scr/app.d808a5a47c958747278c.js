"use strict";(self.webpackChunksnapshot_annotation=self.webpackChunksnapshot_annotation||[]).push([[143],{164:(t,e,n)=>{n.d(e,{Z:()=>l});var r=n(81),o=n.n(r),i=n(645),a=n.n(i)()(o());a.push([t.id,".App {\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n    padding: 0;\n    margin: 0;\n    right: 0;\n    bottom: 0;\n}\n\n.App > * {\n    position: absolute;\n    top: 0;\n    bottom: 0;\n    height: 100%;\n    width: auto;\n}\n\n.App > canvas {\n    left: 0;\n    width: calc(100% - 320px);\n}\n\n.App > aside {\n    right: 0;\n    width: 320px;\n    background-color: var(--theme-color-frame);\n    color: var(--theme-color-on-frame);\n}\n",""]);const l=a},788:(t,e,n)=>{n.d(e,{Z:()=>l});var r=n(81),o=n.n(r),i=n(645),a=n.n(i)()(o());a.push([t.id,":root {\n    --theme-color-screen: hsl(212, 10%, 40%);\n    --theme-color-on-screen: #000;\n    --theme-color-frame: hsl(212, 10%, 60%);\n    --theme-color-on-frame: #000;\n    --theme-color-section: hsl(212, 10%, 80%);\n    --theme-color-on-section: #000;\n    --theme-color-input: hsl(212, 10%, 100%);\n    --theme-color-on-input: #000;\n    --theme-color-primary: hsl(212, 100%, 50%);\n    --theme-color-on-primary: #000;\n    --theme-color-accent: hsl(32, 100%, 50%);\n    --theme-color-on-accent: #000;\n}\n\nbody, html, #app {\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n    margin: 0;\n    padding: 0;\n    overflow: hidden;\n    background-color: var(--theme-color-screen);\n    color: var(--theme-color-on-screen);\n    font-size: 16px;\n}    \n\nbutton.floating-button {\n    border: none;\n    background-color: var(--theme-color-accent);\n    color: var(--theme-color-on-accent);\n    display: grid;\n    place-items: center;\n    width: 2em;\n    height: 2em;\n    box-shadow: 0 .125em .25em #000;\n    overflow: hidden;\n    border-radius: 50%;\n    padding: 0;\n}\n\nbutton.floating-button > svg {\n    width: 1.5em;\n    height: 1.5em;\n    margin: 0;\n    padding: 0;\n}\n\nbutton {\n    font-size: 120%;\n    border: none;\n    cursor: pointer;\n    margin: .5em;\n    padding: 0 .5em;\n    line-height: 2em;\n    background: var(--theme-color-primary);\n    color: var(--theme-color-on-primary);\n    box-shadow: 0 .125em .25em #000;\n    font-variant: small-caps;\n    font-weight: bolder;\n}",""]);const l=a},217:(t,e,n)=>{n.d(e,{Z:()=>l});var r=n(81),o=n.n(r),i=n(645),a=n.n(i)()(o());a.push([t.id,".view-EditorView {}\n",""]);const l=a},507:(t,e,n)=>{n.d(e,{Z:()=>l});var r=n(81),o=n.n(r),i=n(645),a=n.n(i)()(o());a.push([t.id,".view-PolygonButtonView {\n    display: flex;\n    flex-direction: row;\n    justify-content: space-between;\n    align-items: center;\n    margin: .5em;\n}\n\n.view-PolygonButtonView.selected {\n    background-color: var(--theme-color-section);\n    color: var(--theme-color-on-section);\n    box-shadow: 0 .25em .5em #0009;\n}\n\n.view-PolygonButtonView > div {\n    flex: 1 1 auto;\n    line-height: 2em;\n    padding: 0 .5em;\n    background-color: transparent;\n    color: var(--theme-color-on-frame);\n}\n\n.view-PolygonButtonView > div.label:hover {\n    background-color: var(--theme-color-primary);\n    color: var(--theme-color-on-primary);\n    box-shadow: 0 .125em .25em #0009;\n    cursor: pointer;\n}\n\n.view-PolygonButtonView input {\n    border: none;\n    color: var(--theme-color-on-input);\n    background: var(--theme-color-input);\n    height: 2em;\n    padding: 0 .5em;\n    margin: .5em;\n    width: 100%;\n}",""]);const l=a},140:(t,e,n)=>{n.d(e,{Z:()=>l});var r=n(81),o=n.n(r),i=n(645),a=n.n(i)()(o());a.push([t.id,".view-PolygonsListView {}\n",""]);const l=a},103:(t,e,n)=>{var r=n(893),o=n(294),i=n(379),a=n.n(i),l=n(795),s=n.n(l),c=n(569),u=n.n(c),h=n(565),f=n.n(h),g=n(216),d=n.n(g),p=n(589),y=n.n(p),v=n(217),m={};function b(t){return(0,r.jsx)("canvas",{className:x(t),ref:function(e){e&&(t.painter.canvas=e)}})}function x(t){var e=["custom","view-EditorView"];return"string"==typeof t.className&&e.push(t.className),e.join(" ")}m.styleTagTransform=y(),m.setAttributes=f(),m.insert=u().bind(null,"head"),m.domAPI=s(),m.insertStyleElement=d(),a()(v.Z,m),v.Z&&v.Z.locals&&v.Z.locals;const w=n.p+"./img/image.003ee1ba447a846c139d.webp";const P=function(){function t(t){void 0===t&&(t="");var e=this;this.name=t,this.listeners=[],this.fire=function(t){var n,r;try{for(var o=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(e.listeners),i=o.next();!i.done;i=o.next()){var a=i.value;try{a(t)}catch(n){console.error("[".concat(e.name,"] Error in a listener!")),console.error(">  ex.: ",n),console.error(">  arg.: ",t)}}}catch(t){n={error:t}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}}}return Object.defineProperty(t.prototype,"length",{get:function(){return this.listeners.length},enumerable:!1,configurable:!0}),t.prototype.add=function(t){this.remove(t),this.listeners.push(t)},t.prototype.remove=function(t){this.listeners=this.listeners.filter((function(e){return e!==t}))},t.prototype.removeAll=function(){this.listeners.splice(0,this.listeners.length)},t}();function E(t,e){return{x:t.x-e.x,y:t.y-e.y}}function S(t,e){return t.x*e.x+t.y*e.y}function L(t,e){return t.x*e.y-t.y*e.x}function A(t,e){return t>0&&e>0||t<0&&e<0}var D=function(){function t(t,e){this.polygon=t,this.elements=e}return Object.defineProperty(t.prototype,"length",{get:function(){return this.elements.length},enumerable:!1,configurable:!0}),t.prototype.getPoint=function(t){var e=this.getElementIndex(t);return this.polygon.getPoint(e)},t.prototype.removePoint=function(e){var n=this.elements.filter((function(t,n){return n!==e}));return new t(this.polygon,n)},t.prototype.computeConvexity=function(t,e,n){var r=this.getElementIndex(t),o=this.getElementIndex(e),i=this.getElementIndex(n);return this.polygon.computeConvexity(r,o,i)},t.prototype.isEmptyTriangle=function(t,e,n){var r,o,i=this.getPoint(t),a=this.getPoint(e),l=this.getPoint(n),s=E(i,a),c=E(l,i),u=E(a,l);try{for(var h=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(this.polygon.points),f=h.next();!f.done;f=h.next()){var g=f.value,d=L(s,E(g,a));if(A(d,L(c,E(g,i)))&&A(L(u,E(g,l)),d))return!1}}catch(t){r={error:t}}finally{try{f&&!f.done&&(o=h.return)&&o.call(h)}finally{if(r)throw r.error}}return!0},t.prototype.getElementIndex=function(t){var e=this.elements.length;return t<0&&(t+=e*Math.ceil(-t/e)),this.elements[t%e]},t}();const T=D;var I=function(){return I=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},I.apply(this,arguments)};const C=function(){function t(t){void 0===t&&(t=[]),this.eventChange=new P,this._points=t}return t.prototype.reset=function(t){this._points=t.map((function(t){return I({},t)}))},Object.defineProperty(t.prototype,"points",{get:function(){return this._points},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this._points.length},enumerable:!1,configurable:!0}),t.prototype.getPoint=function(t){var e=this.length;if(0===e)throw Error("Polygon is empty!");return t<0&&(t+=e*Math.ceil(-t/e)),this._points[t%e]},t.prototype.getVector=function(t,e){var n=this.getPoint(t);return E(this.getPoint(e),n)},t.prototype.add=function(t,e){void 0===e&&(e=-1);try{e<0||e>this._points.length?this._points.push(t):this._points.splice(e,0,t)}finally{return this.fireChange(),e>-1?e:this.points.length-1}},t.prototype.remove=function(t){this._points.splice(t,1),this.fireChange()},t.prototype.findPoint=function(t){return this._points.findIndex((function(e){var n=t.x-e.x,r=t.y-e.y;return n*n+r*r<100}))},t.prototype.distFromEdge=function(t,e,n){var r,o=this.getPoint(e),i=t,a=E(this.getPoint(n),o),l=S(a,a);if(l<1e-9)return r=E(o,i),Math.sqrt(S(r,r));var s=E(i,o),c=S(s,s),u=S(s,a);return Math.sqrt(c-u*u/l)},Object.defineProperty(t.prototype,"elements",{get:function(){for(var t=Array(this.length),e=0;e<this.length;e++)t[e]=e;return t},enumerable:!1,configurable:!0}),t.prototype.computeConvexity=function(t,e,n){var r=this.getPoint(t),o=this.getPoint(e),i=this.getPoint(n);return L(E(r,o),E(i,o))},t.prototype.triangulate=function(){for(var t=new T(this,this.elements),e=[],n=0;n<this.length&&!(t.length<4);n++)t=_(t,e);return 3===t.length&&e.push([t.getElementIndex(0),t.getElementIndex(1),t.getElementIndex(2)]),e},t.prototype.fireChange=function(){this.eventChange.fire()},t}();function _(t,e){for(var n=function(t){for(var e=0,n=Number.MAX_SAFE_INTEGER,r=0;r<t.length;r++){var o=t.getPoint(r).y;o<n&&(n=o,e=r)}var i=e,a=i-1,l=i+1,s=t.computeConvexity(a,i,l),c=new Set;for(r=0;r<t.length;r++)A(t.computeConvexity(r-1,r,r+1),s)&&c.add(r);return c}(t),r=0;r<t.length;r++)if(n.has(r)&&t.isEmptyTriangle(r-1,r,r+1))return e.push([t.getElementIndex(r-1),t.getElementIndex(r),t.getElementIndex(r+1)]),t.removePoint(r);throw Error("We are not supposed to get here!")}var j=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},B=function(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))};function R(t,e){var n=0;return function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];return new Promise((function(o){window.clearTimeout(n),n=window.setTimeout((function(){return o(t.apply(void 0,B([],j(r),!1)))}),e)}))}}const k=function(){function t(t){var e=this;this.handlers=t,this._element=null,this.timestamp=0,this.button="left",this.x=0,this.y=0,this.documentShiftX=0,this.documentShiftY=0,this.pointerIsDown=!1,this.isDragging=!1,this.handleElementPointerDown=function(t){var n=t.target.getBoundingClientRect(),r=n.left,o=n.top;switch(e.timestamp=t.timeStamp,e.x=t.clientX-r,e.y=t.clientY-o,t.button){case 0:e.button="left";break;case 1:e.button="middle";break;case 2:e.button="right"}e.pointerIsDown=!0},this.handleDocumentPointerDown=function(t){if(e.pointerIsDown){e.isDragging=!0,e.documentShiftX=e.x-t.clientX,e.documentShiftY=e.y-t.clientY;var n=e.handlers,r=n.onDown,o=n.onDragStart;r&&r({x:e.x,y:e.y,button:e.button}),o&&o({x:e.x,y:e.y,button:e.button,cancel:function(){return e.isDragging=!1}})}},this.handleDocumentPointerMove=function(t){if(e.pointerIsDown&&e.isDragging){var n=t.clientX+e.documentShiftX,r=t.clientY+e.documentShiftY,o=e.handlers.onDrag;o&&o({x:n,y:r,button:e.button})}},this.handleDocumentPointerUp=function(t){var n=t.clientX+e.documentShiftX,r=t.clientY+e.documentShiftY,o=e.handlers,i=o.onDragEnd,a=o.onUp,l=o.onTap;e.isDragging&&i&&i({x:n,y:r,button:e.button}),a&&a({x:n,y:r,button:e.button}),l&&t.timeStamp-e.timestamp<300&&l({x:n,y:r,button:e.button}),e.isDragging=!1,e.pointerIsDown=!1},this.handleContextMenu=function(t){t.stopPropagation(),t.preventDefault()}}return t.prototype.attach=function(t){this.detach(),this._element=t,t.addEventListener("pointerdown",this.handleElementPointerDown),t.addEventListener("contextmenu",this.handleContextMenu),document.addEventListener("pointerdown",this.handleDocumentPointerDown),document.addEventListener("pointermove",this.handleDocumentPointerMove),document.addEventListener("pointerup",this.handleDocumentPointerUp)},t.prototype.detach=function(){this._element&&(this._element.removeEventListener("pointerdown",this.handleElementPointerDown),this._element.removeEventListener("contextmenu",this.handleContextMenu),document.removeEventListener("pointerdown",this.handleDocumentPointerDown),document.removeEventListener("pointermove",this.handleDocumentPointerMove),document.removeEventListener("pointerup",this.handleDocumentPointerUp))},t}();var N=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},O=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},F=function(){function t(t){var e=this;this.data=t,this.polygon=new C,this._image=new Image,this.scale=1,this.x=0,this.y=0,this.triangles=[],this.selectedPoint=-1,this.xRayMode=!1,this.handleKeyDown=function(t){" "===t.key&&(e.xRayMode=!0,e.paint())},this.handleKeyUp=function(t){" "===t.key&&(e.xRayMode=!1,e.paint())},this.handleDrag=function(t){var n=e.polygon;if(n&&!(e.selectedPoint<0)){var r=t.x/e.scale,o=t.y/e.scale,i=n.getPoint(e.selectedPoint);i.x=r,i.y=o,e.triangulate()}},this.handleDragEnd=function(t){var n=e.polygon;n&&n.fireChange()},this.handleDragStart=function(t){var n=t.x/e.scale,r=t.y/e.scale;"left"===t.button?e.addDot({x:n,y:r})&&t.cancel():"right"===t.button?(t.cancel(),e.removeDot(n,r)):(t.cancel(),e.triangulate())},this.triangulateLater=R((function(){e.triangulate()}),300),this.handleResize=function(){var t=e.canvas;t.width=t.clientWidth,t.height=t.clientHeight,e.paint()},this._canvas=document.createElement("canvas"),this.observer=new ResizeObserver(this.handleResize),this.watcher=new k({onDragStart:this.handleDragStart,onDrag:this.handleDrag,onDragEnd:this.handleDragEnd}),document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp),this.polygon.eventChange.add(this.triangulateLater)}return t.prototype.resetPolygon=function(t){this.polygon.reset(t.points),this.triangulate()},Object.defineProperty(t.prototype,"canvas",{get:function(){return this._canvas},set:function(t){this._canvas&&(this.watcher.detach(),this.observer.unobserve(this._canvas)),this._canvas=t,this.watcher.attach(t),this.observer.observe(t),this.paint()},enumerable:!1,configurable:!0}),t.prototype.addDot=function(t){var e=this.polygon;if(!e)return!1;var n=e.findPoint(t);if(this.selectedPoint=n,e.length<3)return this.selectedPoint=e.add(t),this.triangulate(),!0;if(n>-1)return!1;for(var r=e.length,o=Number.MAX_SAFE_INTEGER,i=0;i<e.length;i++){var a=e.distFromEdge(t,i,i+1);a<o&&(o=a,r=i+1)}return this.selectedPoint=e.add(t,r),this.triangulate(),!0},t.prototype.removeDot=function(t,e){var n=this.polygon;if(n){var r=n.findPoint({x:t,y:e});r>-1&&(n.remove(r),this.triangulate())}},t.prototype.triangulate=function(){var t=this.polygon;this.triangles=t.triangulate(),this.paint(),window.sessionStorage.setItem("polygon",JSON.stringify(t))},Object.defineProperty(t.prototype,"image",{get:function(){return this._image},set:function(t){this._image=t,this.paint()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ctx",{get:function(){var t=this.canvas.getContext("2d");if(!t)throw Error("Unable to create 2D context!");return t},enumerable:!1,configurable:!0}),t.prototype.paint=function(){var t=this;window.requestAnimationFrame((function(){var e=t,n=e.ctx,r=e.image;e.polygon,n.canvas.width=Math.ceil(n.canvas.clientWidth),n.canvas.height=Math.ceil(n.canvas.clientHeight);var o=n.canvas.width,i=n.canvas.height,a=Math.min(o/r.width,i/r.height);t.scale=a,n.clearRect(0,0,o,i),n.save(),n.scale(a,a),t.xRayMode?t.paintXRay(n):t.paintDefault(n)}))},t.prototype.paintDefault=function(t){var e,n,r,o,i,a,l,s,c=this,u=c.data,h=c.image,f=c.polygon;t.save(),t.globalAlpha=.5,t.drawImage(h,0,0),t.globalAlpha=1,t.save(),t.beginPath();try{for(var g=N(u.getPolygonList()),d=g.next();!d.done;d=g.next()){var p=d.value,y=O(p.points),v=y[0],m=v.x,b=v.y,x=y.slice(1);t.moveTo(m,b);try{for(var w=(r=void 0,N(x)),P=w.next();!P.done;P=w.next()){var E=P.value,S=E.x,L=E.y;t.lineTo(S,L)}}catch(t){r={error:t}}finally{try{P&&!P.done&&(o=w.return)&&o.call(w)}finally{if(r)throw r.error}}t.lineTo(m,b)}}catch(t){e={error:t}}finally{try{d&&!d.done&&(n=g.return)&&n.call(g)}finally{if(e)throw e.error}}if(t.clip(),t.drawImage(h,0,0),t.restore(),f.points.length>0){t.strokeStyle="#000",t.lineWidth=3,t.beginPath();var A=O(f.points),D=A[0];m=D.x,b=D.y,x=A.slice(1),t.moveTo(m,b);try{for(var T=N(x),I=T.next();!I.done;I=T.next()){var C=I.value,_=C.x,j=C.y;t.lineTo(_,j)}}catch(t){i={error:t}}finally{try{I&&!I.done&&(a=T.return)&&a.call(T)}finally{if(i)throw i.error}}t.closePath(),t.stroke(),t.font="bold ".concat(Math.ceil(15),"px sans-serif"),t.textBaseline="middle",t.textAlign="center";var B=0;try{for(var R=N(f.points),k=R.next();!k.done;k=R.next()){var F=k.value,M=F.x,U=F.y;t.fillStyle="#000",t.beginPath(),t.ellipse(M,U,10,10,0,0,2*Math.PI),t.fill(),t.fillStyle="#fff",t.fillText("".concat(B++),M,U)}}catch(t){l={error:t}}finally{try{k&&!k.done&&(s=R.return)&&s.call(R)}finally{if(l)throw l.error}}}t.restore()},t.prototype.paintXRay=function(t){var e,n,r=this.image,o=this.polygon;t.save(),t.globalAlpha=.1,t.drawImage(r,0,0),t.beginPath();var i=O(o.points),a=i[0],l=a.x,s=a.y,c=i.slice(1);t.moveTo(l,s);try{for(var u=N(c),h=u.next();!h.done;h=u.next()){var f=h.value,g=f.x,d=f.y;t.lineTo(g,d)}}catch(t){e={error:t}}finally{try{h&&!h.done&&(n=u.return)&&n.call(u)}finally{if(e)throw e.error}}t.closePath(),t.clip(),t.globalAlpha=1,t.drawImage(r,0,0),t.restore()},t}();const M=F;var U=n(507),Z={};Z.styleTagTransform=y(),Z.setAttributes=f(),Z.insert=u().bind(null,"head"),Z.domAPI=s(),Z.insertStyleElement=d(),a()(U.Z,Z),U.Z&&U.Z.locals&&U.Z.locals;var G=function(){return G=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},G.apply(this,arguments)};function V(t){var e=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}(o.useState(t.value.name),2),n=e[0],i=e[1],a=t.value;return(0,r.jsxs)("div",G({className:W(t),title:"#".concat(a.id)},{children:[t.selected&&(0,r.jsx)("input",{value:n,autoFocus:!0,onChange:function(t){return i(t.target.value)}}),!t.selected&&(0,r.jsx)("div",G({className:"label",onClick:function(){return t.onSelect(a.id)}},{children:t.value.name})),!t.selected&&(0,r.jsx)("button",G({className:"floating-button",onClick:function(){return t.onDelete(a.id)}},{children:(0,r.jsx)("svg",G({viewBox:"0 0 24 24"},{children:(0,r.jsx)("path",{fill:"currentColor",d:"M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19M8.46,11.88L9.87,10.47L12,12.59L14.12,10.47L15.53,11.88L13.41,14L15.53,16.12L14.12,17.53L12,15.41L9.88,17.53L8.47,16.12L10.59,14L8.46,11.88M15.5,4L14.5,3H9.5L8.5,4H5V6H19V4H15.5Z"})}))}))]}))}function W(t){var e=["custom","view-PolygonButtonView"];return"string"==typeof t.className&&e.push(t.className),t.selected&&e.push("selected"),e.join(" ")}var H=n(140),X={};X.styleTagTransform=y(),X.setAttributes=f(),X.insert=u().bind(null,"head"),X.domAPI=s(),X.insertStyleElement=d(),a()(H.Z,X),H.Z&&H.Z.locals&&H.Z.locals;var Y=n(142),z=n.n(Y);function K(t){return"number"==typeof t}function q(t){return Array.isArray(t)}function J(t){return!!t&&!Array.isArray(t)&&"object"==typeof t}var Q=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};function $(t){var e,n;if(!J(t))return!1;if(!K(t.id))return!1;if(!function(t){return"string"==typeof t}(t.name))return!1;if(!q(t.points))return!1;try{for(var r=Q(t.points),o=r.next();!o.done;o=r.next())if(!tt(o.value))return!1}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}return!0}function tt(t){return!!J(t)&&!!K(t.x)&&!!K(t.y)}var et="PolygonItems";var nt=function(){return nt=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},nt.apply(this,arguments)},rt=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};const ot=function(){function t(t){var e=this;if(this.storage=t,this.save=R((function(){!function(t,e){t.setItem(et,z().stringify(e))}(e.storage,e.polygonList)}),500),this.eventPolygonListChange=new P,this.eventCurrentPolygonChange=new P,this.polygonList=function(t){try{var e=t.getItem(et);if(null===e)return[{id:1,name:"Polygon_1",points:[]}];var n=z().parse(e);return function(t){var e,n;if(!q(t))return!1;try{for(var r=Q(t),o=r.next();!o.done;o=r.next())if(!$(o.value))return!1}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}return!0}(n)&&0!==n.length?n:[{id:1,name:"Polygon_1",points:[]}]}catch(t){return console.error("Unable to retrieve PolygonItems:",t),[{id:1,name:"Polygon_1",points:[]}]}}(t),0===this.polygonList.length)throw Error("PolygonItem list must never be empty!");this._currentPolygonId=this.polygonList[0].id}return t.getSingleton=function(){return t.instance||(t.instance=new t(window.localStorage)),t.instance},t.prototype.getPolygonList=function(){return this.polygonList.map((function(t){return nt({},t)}))},t.prototype.firePolygonListChanged=function(){this.eventPolygonListChange.fire(function(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))}([],function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}(this.polygonList),!1)),this.save()},Object.defineProperty(t.prototype,"currentPolygonId",{get:function(){return this._currentPolygonId},set:function(t){var e,n;try{for(var r=rt(this.polygonList),o=r.next();!o.done;o=r.next())if(o.value.id===t)return this._currentPolygonId=t,void this.eventCurrentPolygonChange.fire(t)}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}},enumerable:!1,configurable:!0}),t.prototype.updatePolygon=function(t){var e=this,n=t.name,r=t.points,o=this.polygonList.find((function(t){return t.id===e.currentPolygonId}));if(o){var i=!1;r&&(o.points=r.map((function(t){return nt({},t)})),i=!0),n&&(this.findPolygonByName(n)||(o.name=n,i=!0)),i&&(this.firePolygonListChanged(),this.save())}},t.prototype.addPolygonToList=function(){var t=this.getFirstFreeId(),e="Polygon_".concat(t);this.findPolygonByName(e)&&(e=this.makeNewPolygonName());var n={id:t,name:e,points:this.getCurrentPolygon().points.map((function(t){return nt({},t)}))};return this.polygonList.push(n),this.currentPolygonId=t,this.firePolygonListChanged(),n},t.prototype.removePolygonFromList=function(t){if(t===this.currentPolygonId)return!1;var e=this.polygonList.findIndex((function(e){return e.id===t}));return!(e<0||(this.polygonList.splice(e,1),this.firePolygonListChanged(),0))},t.prototype.getCurrentPolygon=function(){var t=this,e=this.polygonList.find((function(e){return e.id===t.currentPolygonId}));if(e)return nt({},e);if(console.error("There is no polygon with id #".concat(this.currentPolygonId,"!")),console.error("That means that the selected polygon has gone."),0===this.polygonList.length)throw Error("The polygon list is empty!");return this.currentPolygonId=this.polygonList[0].id,nt({},this.polygonList[0])},t.prototype.makeNewPolygonName=function(){for(var t=0;t<9999;t++){var e="Polygon_".concat(t);if(!this.findPolygonByName(e))return e}return"Polygon_".concat(Date.now())},t.prototype.findPolygonByName=function(t){var e=t.trim().toLowerCase();return this.polygonList.find((function(t){return t.name.trim().toLowerCase()===e}))},t.prototype.getFirstFreeId=function(){var t,e,n=0;try{for(var r=rt(this.polygonList),o=r.next();!o.done;o=r.next()){var i=o.value;if(i.id-n>1)return i.id-1;n=i.id}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}return n+1},t}(),it=o.createContext(ot.getSingleton());var at=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a};function lt(){return o.useContext(it)}var st=function(){return st=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},st.apply(this,arguments)};function ct(t){var e=lt(),n=function(){var t=lt(),e=at(o.useState(t.getPolygonList()),2),n=e[0],r=e[1];return o.useEffect((function(){return t.eventPolygonListChange.add(r),function(){return t.eventPolygonListChange.remove(r)}}),[t]),n}(),i=function(){var t=lt(),e=at(o.useState(t.currentPolygonId),2),n=e[0],r=e[1];return o.useEffect((function(){return t.eventCurrentPolygonChange.add(r),function(){return t.eventCurrentPolygonChange.remove(r)}}),[t]),n}(),a=function(t){return e.removePolygonFromList(t)},l=function(n){e.currentPolygonId=n,t.onClick(e.getCurrentPolygon())};return(0,r.jsxs)("div",st({className:ut(t)},{children:[(0,r.jsx)("div",st({className:"list"},{children:n.map((function(t){return(0,r.jsx)(V,{selected:t.id===i,value:t,onSelect:l,onDelete:a},t.id)}))})),(0,r.jsx)("button",st({onClick:function(){return e.addPolygonToList()}},{children:"Add new Polygon"}))]}))}function ut(t){var e=["custom","view-PolygonsListView"];return"string"==typeof t.className&&e.push(t.className),e.join(" ")}var ht=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},ft=function(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))},gt=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};function dt(t,e){var n=t.getPolygonList(),r=function(t){var e,n,r,o,i=[],a=0;try{for(var l=gt(t.getPolygonList()),s=l.next();!s.done;s=l.next()){var c=s.value,u=[],h=new C(c.points).triangulate();try{for(var f=(r=void 0,gt(h)),g=f.next();!g.done;g=f.next()){var d=ht(g.value,3),p=d[0],y=d[1],v=d[2];u.push(a+p,a+y,a+v)}}catch(t){r={error:t}}finally{try{g&&!g.done&&(o=f.return)&&o.call(f)}finally{if(r)throw r.error}}i.push(u),a+=c.points.length}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=l.return)&&n.call(l)}finally{if(e)throw e.error}}return i}(t);return pt(["// prettier-ignore","export default class ".concat("Painter"," {"),ft(ft([],ht(yt(t)),!1),["","private readonly prg: WebGLProgram","private readonly texBackground: WebGLTexture","private readonly texForeground: WebGLTexture","private readonly backBuff: WebGLBuffer","private readonly drawBuff: WebGLBuffer","private readonly elemBuff: WebGLBuffer","private readonly offsets = [".concat(vt(r),"]"),"private readonly sizes = ".concat(JSON.stringify(r.map((function(t){return t.length})))),"private readonly sprites = new Uint8Array(".concat(n.length,")"),"","constructor(",["private readonly gl: WebGL2RenderingContext,","background: HTMLImageElement,","foreground: HTMLImageElement"],") {",["const ratio = ensureSameAspectRatio(background, foreground)","const x = ratio > 1 ? 1 : 1 / ratio","const y = ratio > 1 ? ratio : 1","this.backBuff = this.createDrawBuffer([",["-x, +y, -1, +1,","-x, -y, -1, -1,","+x, -y, +1, -1,","+x, +y, +1, +1"],"])","this.elemBuff = this.createElemBuffer([",r.map((function(t,e){return"".concat(t.join(", "),",  // ").concat(n[e].name)})),"])","this.drawBuff = this.createDrawBuffer([",n.map((function(t,r){return"".concat(t.points.map((function(t){var n=t.x,r=t.y;return"".concat((n/e.width).toFixed(5),",").concat((r/e.height).toFixed(5))})).join(", "),",  // ").concat(n[r].name)})),"])","this.texBackground = this.createTexture(background)","this.texForeground = this.createTexture(foreground)","this.prg = createProgram(gl)"],"}","","on(...spriteIndexes: number[]) {",["for (const index of spriteIndexes) {",["this.sprites[index] = 1"],"}"],"}","","off(...spriteIndexes: number[]) {",["for (const index of spriteIndexes) {",["this.sprites[index] = 0"],"}"],"}","","onAll() {",["for (let index = 0; index < this.sprites.length; index++) {",["this.sprites[index] = 1"],"}"],"}","","offAll() {",["for (let index = 0; index < this.sprites.length; index++) {",["this.sprites[index] = 0"],"}"],"}","","draw(index: number) {",["const { gl, prg } = this","const w = gl.drawingBufferWidth","const h = gl.drawingBufferHeight","const { canvas } = gl","if (canvas.width !== w || canvas.height !== h) {",["canvas.width = w","canvas.height = h"],"}","gl.viewport(0, 0, w, h)","gl.bindBuffer( gl.ARRAY_BUFFER, this.drawBuff )","gl.bindBuffer( gl.ELEMENT_ARRAY_BUFFER, this.elemBuff )","for (let index = 0; index < this.sprites.length; index++) {",["if (this.sprites[index] === 0) continue","","const offset = this.offsets[index]","const size = this.sizes[index]","gl.drawElements( gl.TRIANGLES, size, gl.UNSIGNED_SHORT, offset )"],"}"],"}","","private createDrawBuffer(data: number[]): WebGLBuffer {",["const { gl } = this","const buff = gl.createBuffer()",'if (!buff) throw Error("Unable to create a WebGLBuffer!")',"","gl.bindBuffer( gl.ARRAY_BUFFER, buff )","gl.bufferData(",["gl.ARRAY_BUFFER,","new Float32Array(data),","gl.STATIC_DRAW"],")","return buff"],"}","","private createElemBuffer(data: number[]): WebGLBuffer {",["const { gl } = this","const buff = gl.createBuffer()",'if (!buff) throw Error("Unable to create a WebGLBuffer!")',"","gl.bindBuffer( gl.ELEMENT_ARRAY_BUFFER, buff )","gl.bufferData(",["gl.ELEMENT_ARRAY_BUFFER,","new Uint16Array(data),","gl.STATIC_DRAW"],")","return buff"],"}","","createTexture(img: HTMLImageElement): WebGLTexture {",["const { gl } = this","const tex = gl.createTexture()",'if (!tex) throw Error("Enable to create a WebGLTexture!")',"","gl.bindTexture(gl.TEXTURE_2D, tex)","gl.texImage2D(",["gl.TEXTURE_2D, 0,","gl.RGBA, gl.RGBA,","gl.UNSIGNED_BYTE,","img"],")","return tex"],"}"],!1),"}","","interface Dimension {",["width: number","height: number"],"}","","function ensureSameAspectRatio(img1: Dimension, img2: Dimension): number {",["const ratio1 = img1.width / img1.height","const ratio2 = img2.width / img2.height","if (Math.abs(ratio1 - ratio2) > 1e-6) {",['throw Error("Background and foregroung must have the same aspect ratio!")'],"}","return ratio1"],"}","","function createProgram(gl: WebGL2RenderingContext) {",["const prg = gl.createProgram()",'if (!prg) throw Error("Unable to create WebGL Program!")',"","const vertShader = gl.createShader(gl.VERTEX_SHADER)",'if (!vertShader) throw Error("Unable to create a Vertex Shader handle!")',"","gl.shaderSource(vertShader, VERT)","gl.compileShader(vertShader)","gl.attachShader(prg, vertShader)","const fragShader = gl.createShader(gl.FRAGMENT_SHADER)",'if (!fragShader) throw Error("Unable to create a Fragment Shader handle!")',"","gl.shaderSource(fragShader, FRAG)","gl.compileShader(fragShader)","gl.attachShader(prg, fragShader)","gl.linkProgram(prg)","return prg"],"}","","const VERT = `".concat("#version 300 es\n\nuniform vec2 uniAspectRatioContain;\nuniform float uniZ;\nin vec2 attPoint;\nin vec2 attUV;\nout vec2 varUV;\n\nvoid main() {\n    varUV = attUV;\n    gl_Position = vec4(attPoint * uniAspectRatioContain, uniZ, 1.0);\n}\n".trim(),"`"),"const FRAG = `".concat("#version 300 es\n\nprecision mediump float;\n\nuniform sampler2D uniTexture;\nin vec2 varUV;\nout vec4 FragColor;\n\nvoid main() {\n    FragColor = texture( uniTexture, varUV );\n}\n".trim(),"`")])}function pt(t,e){return void 0===e&&(e=""),t.map((function(t){return"string"==typeof t?"".concat(e).concat(t):pt(t,"".concat(e,"    "))})).join("\n")}function yt(t){return t.getPolygonList().map((function(t,e){return"static ".concat(t.name.toUpperCase()," = ").concat(e)}))}function vt(t){var e=0;return t.map((function(t){var n=e;return e+=t.length,n}))}var mt=n(164),bt={};bt.styleTagTransform=y(),bt.setAttributes=f(),bt.insert=u().bind(null,"head"),bt.domAPI=s(),bt.insertStyleElement=d(),a()(mt.Z,bt),mt.Z&&mt.Z.locals&&mt.Z.locals;var xt=function(){return xt=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},xt.apply(this,arguments)};function wt(t){var e=lt(),n=o.useRef(new M(e));return o.useEffect((function(){var t=new Image;t.src=w,t.onload=function(){n.current.image=t}}),[]),o.useEffect((function(){var t=n.current,r=function(){return e.updatePolygon({points:t.polygon.points})};return t.polygon.eventChange.add(r),t.resetPolygon(e.getCurrentPolygon()),function(){return t.polygon.eventChange.remove(r)}}),[e,n.current]),(0,r.jsxs)("div",xt({className:Pt(t)},{children:[(0,r.jsx)(b,{painter:n.current}),(0,r.jsxs)("aside",{children:[(0,r.jsx)("button",{children:"Load Image"}),(0,r.jsx)(ct,{onClick:function(t){n.current.resetPolygon(t)}}),(0,r.jsx)("button",xt({onClick:function(){var t=dt(e,n.current.image);console.log(t),navigator.clipboard.writeText(t)}},{children:"Export Code"}))]})]}))}function Pt(t){var e=["custom","App"];return"string"==typeof t.className&&e.push(t.className),e.join(" ")}var Et=n(745),St=n(788),Lt={};Lt.styleTagTransform=y(),Lt.setAttributes=f(),Lt.insert=u().bind(null,"head"),Lt.domAPI=s(),Lt.insertStyleElement=d(),a()(St.Z,Lt),St.Z&&St.Z.locals&&St.Z.locals;var At=function(){return At=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},At.apply(this,arguments)};!function(){var t,e,n,o;t=this,e=void 0,o=function(){var t;return function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}(this,(function(e){if(!(t=document.getElementById("app")))throw Error('No element with id "app"!');return(0,Et.s)(t).render((0,r.jsx)(it.Provider,At({value:ot.getSingleton()},{children:(0,r.jsx)(wt,{})}))),[2]}))},new((n=void 0)||(n=Promise))((function(r,i){function a(t){try{s(o.next(t))}catch(t){i(t)}}function l(t){try{s(o.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,l)}s((o=o.apply(t,e||[])).next())}))}()}},t=>{t.O(0,[977],(()=>(103,t(t.s=103)))),t.O()}]);