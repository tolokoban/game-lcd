"use strict";(self.webpackChunksnapshot_annotation=self.webpackChunksnapshot_annotation||[]).push([[143],{961:(t,e,n)=>{n.d(e,{Z:()=>l});var r=n(81),o=n.n(r),i=n(645),a=n.n(i)()(o());a.push([t.id,".App {\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n    padding: 0;\n    margin: 0;\n    right: 0;\n    bottom: 0;\n}\n\n.App > * {\n    position: absolute;\n    top: 0;\n    bottom: 0;\n    height: 100%;\n    width: auto;\n}\n\n.App > canvas {\n    left: 0;\n    width: calc(100% - 320px);\n}\n\n.App > aside {\n    right: 0;\n    width: 320px;\n    background-color: var(--theme-color-frame);\n    color: var(--theme-color-on-frame);\n    overflow: auto;\n}\n",""]);const l=a},270:(t,e,n)=>{n.d(e,{Z:()=>l});var r=n(81),o=n.n(r),i=n(645),a=n.n(i)()(o());a.push([t.id,".view-EditorView {}\n",""]);const l=a},128:(t,e,n)=>{n.d(e,{Z:()=>l});var r=n(81),o=n.n(r),i=n(645),a=n.n(i)()(o());a.push([t.id,".view-PolygonButtonView {\n    display: flex;\n    flex-direction: row;\n    justify-content: space-between;\n    align-items: center;\n    margin: .5em;\n}\n\n.view-PolygonButtonView.selected {\n    background-color: var(--theme-color-section);\n    color: var(--theme-color-on-section);\n    box-shadow: 0 .25em .5em #0009;\n}\n\n.view-PolygonButtonView > div {\n    flex: 1 1 auto;\n    line-height: 2em;\n    padding: 0 .5em;\n    background-color: transparent;\n    color: var(--theme-color-on-frame);\n}\n\n.view-PolygonButtonView > div.label:hover {\n    background-color: var(--theme-color-primary);\n    color: var(--theme-color-on-primary);\n    box-shadow: 0 .125em .25em #0009;\n    cursor: pointer;\n}\n\n.view-PolygonButtonView input {\n    border: none;\n    color: var(--theme-color-on-input);\n    background: var(--theme-color-input);\n    height: 2em;\n    padding: 0 .5em;\n    margin: .5em;\n    width: 100%;\n}",""]);const l=a},242:(t,e,n)=>{n.d(e,{Z:()=>l});var r=n(81),o=n.n(r),i=n(645),a=n.n(i)()(o());a.push([t.id,".view-PolygonsListView {}\n",""]);const l=a},904:(t,e,n)=>{n.d(e,{Z:()=>g});var r=n(81),o=n.n(r),i=n(645),a=n.n(i),l=n(667),s=n.n(l),c=new URL(n(134),n.b),u=new URL(n(715),n.b),h=a()(o()),f=s()(c),A=s()(u);h.push([t.id,"div.game,\ndiv.game > canvas {\n    position: absolute;\n    left: 0;\n    top: 0;\n    bottom: 0;\n    right: 0;\n    width: 100%;\n    height: 100%;\n    padding: 0;\n    margin: 0;\n}\n\ndiv.game > canvas {\n    background-repeat: repeat;\n    background-image: url("+f+');\n}\n\ndiv.game > div#score {\n    color: #000;\n    background-color: #fffd;\n    font-size: 5vmin;\n    margin: 0 -1.5em;\n    width: 3em;\n    height: 2em;\n    display: grid;\n    place-items: center;\n    position: absolute;\n    left: 50%;\n    top: 0;\n    border-radius: 0 0 1em 1em;\n    box-shadow: 0 2px 4px #0009;\n}\n\ndiv.game > div.button-red {\n    position: absolute;\n    bottom: 1vmax;\n    width: 9vmax;\n    height: 9vmax;\n    content: ".";\n    font-size: 0;\n    background-image: url('+A+");\n    background-repeat: no-repeat;\n    background-size: contain;\n    pointer-events: none;\n}\n\ndiv.game > div.button-red.left {\n    left: 1vmax;\n}\n\ndiv.game > div.button-red.right {\n    right: 1vmax;\n}\n",""]);const g=h},788:(t,e,n)=>{n.d(e,{Z:()=>l});var r=n(81),o=n.n(r),i=n(645),a=n.n(i)()(o());a.push([t.id,":root {\n    --theme-color-screen: hsl(212, 10%, 40%);\n    --theme-color-on-screen: #000;\n    --theme-color-frame: hsl(212, 10%, 60%);\n    --theme-color-on-frame: #000;\n    --theme-color-section: hsl(212, 10%, 80%);\n    --theme-color-on-section: #000;\n    --theme-color-input: hsl(212, 10%, 100%);\n    --theme-color-on-input: #000;\n    --theme-color-primary: hsl(212, 100%, 50%);\n    --theme-color-on-primary: #000;\n    --theme-color-accent: hsl(32, 100%, 50%);\n    --theme-color-on-accent: #000;\n}\n\nbody,\nhtml,\n#app {\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n    margin: 0;\n    padding: 0;\n    overflow: hidden;\n    background-color: var(--theme-color-screen);\n    color: var(--theme-color-on-screen);\n    font-size: 16px;\n}\n\nbutton.floating-button {\n    border: none;\n    background-color: var(--theme-color-accent);\n    color: var(--theme-color-on-accent);\n    display: grid;\n    place-items: center;\n    width: 2em;\n    height: 2em;\n    box-shadow: 0 0.125em 0.25em #000;\n    overflow: hidden;\n    border-radius: 50%;\n    padding: 0;\n}\n\nbutton.floating-button > svg {\n    width: 1.5em;\n    height: 1.5em;\n    margin: 0;\n    padding: 0;\n}\n\nbutton {\n    font-size: 120%;\n    border: none;\n    cursor: pointer;\n    margin: 0.5em;\n    padding: 0 0.5em;\n    line-height: 2em;\n    background: var(--theme-color-primary);\n    color: var(--theme-color-on-primary);\n    box-shadow: 0 0.25em 0.5em #0007;\n    font-variant: small-caps;\n    font-weight: bolder;\n    transition: all 0.2s;\n}\n\nbutton:active {\n    box-shadow: 0 0.125em 0.25em #000a;\n    transform: translateY(0.125em);\n}\n",""]);const l=a},413:(t,e,n)=>{var r=n(893),o=n(294),i=n(379),a=n.n(i),l=n(795),s=n.n(l),c=n(569),u=n.n(c),h=n(565),f=n.n(h),A=n(216),g=n.n(A),d=n(589),p=n.n(d),y=n(270),v={};function m(t){return(0,r.jsx)("canvas",{className:b(t),ref:function(e){e&&(t.painter.canvas=e)}})}function b(t){var e=["custom","view-EditorView"];return"string"==typeof t.className&&e.push(t.className),e.join(" ")}v.styleTagTransform=p(),v.setAttributes=f(),v.insert=u().bind(null,"head"),v.domAPI=s(),v.insertStyleElement=g(),a()(y.Z,v),y.Z&&y.Z.locals&&y.Z.locals;const E=n.p+"./img/sprites.27d25f8da9171c32e346.webp";const x=function(){function t(t){void 0===t&&(t="");var e=this;this.name=t,this.listeners=[],this.fire=function(t){var n,r;try{for(var o=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(e.listeners),i=o.next();!i.done;i=o.next()){var a=i.value;try{a(t)}catch(n){console.error("[".concat(e.name,"] Error in a listener!")),console.error(">  ex.: ",n),console.error(">  arg.: ",t)}}}catch(t){n={error:t}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}}}return Object.defineProperty(t.prototype,"length",{get:function(){return this.listeners.length},enumerable:!1,configurable:!0}),t.prototype.add=function(t){this.remove(t),this.listeners.push(t)},t.prototype.remove=function(t){this.listeners=this.listeners.filter((function(e){return e!==t}))},t.prototype.removeAll=function(){this.listeners.splice(0,this.listeners.length)},t}();function T(t,e){return{x:t.x-e.x,y:t.y-e.y}}function w(t,e){return t.x*e.x+t.y*e.y}function R(t,e){return t.x*e.y-t.y*e.x}function B(t,e){return t>0&&e>0||t<0&&e<0}var I=function(){function t(t,e){this.polygon=t,this.elements=e}return Object.defineProperty(t.prototype,"length",{get:function(){return this.elements.length},enumerable:!1,configurable:!0}),t.prototype.getPoint=function(t){var e=this.getElementIndex(t);return this.polygon.getPoint(e)},t.prototype.removePoint=function(e){var n=this.elements.filter((function(t,n){return n!==e}));return new t(this.polygon,n)},t.prototype.computeConvexity=function(t,e,n){var r=this.getElementIndex(t),o=this.getElementIndex(e),i=this.getElementIndex(n);return this.polygon.computeConvexity(r,o,i)},t.prototype.isEmptyTriangle=function(t,e,n){var r,o,i=this.getPoint(t),a=this.getPoint(e),l=this.getPoint(n),s=T(i,a),c=T(l,i),u=T(a,l);try{for(var h=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(this.polygon.points),f=h.next();!f.done;f=h.next()){var A=f.value,g=R(s,T(A,a));if(B(g,R(c,T(A,i)))&&B(R(u,T(A,l)),g))return!1}}catch(t){r={error:t}}finally{try{f&&!f.done&&(o=h.return)&&o.call(h)}finally{if(r)throw r.error}}return!0},t.prototype.getElementIndex=function(t){var e=this.elements.length;return t<0&&(t+=e*Math.ceil(-t/e)),this.elements[t%e]},t}();const P=I;var O=function(){return O=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},O.apply(this,arguments)};const C=function(){function t(t){void 0===t&&(t=[]),this.eventChange=new x,this._points=t}return t.prototype.reset=function(t){this._points=t.map((function(t){return O({},t)}))},Object.defineProperty(t.prototype,"points",{get:function(){return this._points},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this._points.length},enumerable:!1,configurable:!0}),t.prototype.getPoint=function(t){var e=this.length;if(0===e)throw Error("Polygon is empty!");return t<0&&(t+=e*Math.ceil(-t/e)),this._points[t%e]},t.prototype.getVector=function(t,e){var n=this.getPoint(t);return T(this.getPoint(e),n)},t.prototype.add=function(t,e){void 0===e&&(e=-1);try{e<0||e>this._points.length?this._points.push(t):this._points.splice(e,0,t)}finally{return this.fireChange(),e>-1?e:this.points.length-1}},t.prototype.remove=function(t){this._points.splice(t,1),this.fireChange()},t.prototype.findPoint=function(t){return this._points.findIndex((function(e){var n=t.x-e.x,r=t.y-e.y;return n*n+r*r<100}))},t.prototype.distFromEdge=function(t,e,n){var r,o=this.getPoint(e),i=t,a=T(this.getPoint(n),o),l=w(a,a);if(l<1e-9)return r=T(o,i),Math.sqrt(w(r,r));var s=T(i,o),c=w(s,s),u=w(s,a);return Math.sqrt(c-u*u/l)},Object.defineProperty(t.prototype,"elements",{get:function(){for(var t=Array(this.length),e=0;e<this.length;e++)t[e]=e;return t},enumerable:!1,configurable:!0}),t.prototype.computeConvexity=function(t,e,n){var r=this.getPoint(t),o=this.getPoint(e),i=this.getPoint(n);return R(T(r,o),T(i,o))},t.prototype.triangulate=function(){for(var t=new P(this,this.elements),e=[],n=0;n<this.length&&!(t.length<4);n++)t=_(t,e);return 3===t.length&&e.push([t.getElementIndex(0),t.getElementIndex(1),t.getElementIndex(2)]),e},t.prototype.fireChange=function(){this.eventChange.fire()},t}();function _(t,e){for(var n=function(t){for(var e=0,n=Number.MAX_SAFE_INTEGER,r=0;r<t.length;r++){var o=t.getPoint(r).y;o<n&&(n=o,e=r)}var i=e,a=i-1,l=i+1,s=t.computeConvexity(a,i,l),c=new Set;for(r=0;r<t.length;r++)B(t.computeConvexity(r-1,r,r+1),s)&&c.add(r);return c}(t),r=0;r<t.length;r++)if(n.has(r)&&t.isEmptyTriangle(r-1,r,r+1))return e.push([t.getElementIndex(r-1),t.getElementIndex(r),t.getElementIndex(r+1)]),t.removePoint(r);throw Error("We are not supposed to get here!")}var L=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},M=function(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))};function S(t,e){var n=0;return function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];return new Promise((function(o){window.clearTimeout(n),n=window.setTimeout((function(){return o(t.apply(void 0,M([],L(r),!1)))}),e)}))}}const D=function(){function t(t){var e=this;this.handlers=t,this._element=null,this.timestamp=0,this.button="left",this.x=0,this.y=0,this.documentShiftX=0,this.documentShiftY=0,this.pointerIsDown=!1,this.isDragging=!1,this.handleElementPointerDown=function(t){var n=t.target.getBoundingClientRect(),r=n.left,o=n.top;switch(e.timestamp=t.timeStamp,e.x=t.clientX-r,e.y=t.clientY-o,t.button){case 0:e.button="left";break;case 1:e.button="middle";break;case 2:e.button="right"}e.pointerIsDown=!0},this.handleDocumentPointerDown=function(t){if(e.pointerIsDown){e.isDragging=!0,e.documentShiftX=e.x-t.clientX,e.documentShiftY=e.y-t.clientY;var n=e.handlers,r=n.onDown,o=n.onDragStart;r&&r({x:e.x,y:e.y,button:e.button}),o&&o({x:e.x,y:e.y,button:e.button,cancel:function(){return e.isDragging=!1}})}},this.handleDocumentPointerMove=function(t){if(e.pointerIsDown&&e.isDragging){var n=t.clientX+e.documentShiftX,r=t.clientY+e.documentShiftY,o=e.handlers.onDrag;o&&o({x:n,y:r,button:e.button})}},this.handleDocumentPointerUp=function(t){var n=t.clientX+e.documentShiftX,r=t.clientY+e.documentShiftY,o=e.handlers,i=o.onDragEnd,a=o.onUp,l=o.onTap;e.isDragging&&i&&i({x:n,y:r,button:e.button}),a&&a({x:n,y:r,button:e.button}),l&&t.timeStamp-e.timestamp<300&&l({x:n,y:r,button:e.button}),e.isDragging=!1,e.pointerIsDown=!1},this.handleContextMenu=function(t){t.stopPropagation(),t.preventDefault()}}return t.prototype.attach=function(t){this.detach(),this._element=t,t.addEventListener("pointerdown",this.handleElementPointerDown),t.addEventListener("contextmenu",this.handleContextMenu),document.addEventListener("pointerdown",this.handleDocumentPointerDown),document.addEventListener("pointermove",this.handleDocumentPointerMove),document.addEventListener("pointerup",this.handleDocumentPointerUp)},t.prototype.detach=function(){this._element&&(this._element.removeEventListener("pointerdown",this.handleElementPointerDown),this._element.removeEventListener("contextmenu",this.handleContextMenu),document.removeEventListener("pointerdown",this.handleDocumentPointerDown),document.removeEventListener("pointermove",this.handleDocumentPointerMove),document.removeEventListener("pointerup",this.handleDocumentPointerUp))},t}();var k=function(){return k=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},k.apply(this,arguments)},U=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},F=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},j=function(){function t(t){var e=this;this.data=t,this.polygon=new C,this._image=new Image,this.scale=1,this.x=0,this.y=0,this.triangles=[],this.selectedPoint=-1,this.xRayMode=!1,this.pointsToMoveTogether=[],this.originX=0,this.originY=0,this.handleKeyDown=function(t){" "===t.key&&(e.xRayMode=!0,e.paint())},this.handleKeyUp=function(t){" "===t.key&&(e.xRayMode=!1,e.paint())},this.handleDrag=function(t){var n=e.polygon;if(n){var r=t.x/e.scale,o=t.y/e.scale;if(console.log("🚀 [painter] evt.button = ",t.button),"right"===t.button){for(var i=0;i<e.pointsToMoveTogether.length;i++){var a=e.pointsToMoveTogether[i],l=a.x,s=a.y;n.points[i].x=l+r-e.originX,n.points[i].y=s+o-e.originY}e.paint()}else if("left"===t.button){if(e.selectedPoint<0)return;var c=n.getPoint(e.selectedPoint);c.x=r,c.y=o,e.triangulate()}}},this.handleDragEnd=function(t){var n=e.polygon;n&&n.fireChange()},this.handleDragStart=function(t){var n=t.x/e.scale,r=t.y/e.scale;"left"===t.button?e.addDot({x:n,y:r})&&t.cancel():"middle"===t.button?(t.cancel(),e.removeDot(n,r)):(console.log("🚀 [painter] evt.button = ",t.button),e.pointsToMoveTogether=e.polygon.points.map((function(t){return k({},t)})),e.originX=n,e.originY=r)},this.triangulateLater=S((function(){e.triangulate()}),300),this.handleResize=function(){var t=e.canvas;t.width=t.clientWidth,t.height=t.clientHeight,e.paint()},this._canvas=document.createElement("canvas"),this.observer=new ResizeObserver(this.handleResize),this.watcher=new D({onDragStart:this.handleDragStart,onDrag:this.handleDrag,onDragEnd:this.handleDragEnd}),document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp),this.polygon.eventChange.add(this.triangulateLater)}return t.prototype.resetPolygon=function(t){this.polygon.reset(t.points),this.triangulate()},Object.defineProperty(t.prototype,"canvas",{get:function(){return this._canvas},set:function(t){this._canvas&&(this.watcher.detach(),this.observer.unobserve(this._canvas)),this._canvas=t,this.watcher.attach(t),this.observer.observe(t),this.paint()},enumerable:!1,configurable:!0}),t.prototype.addDot=function(t){var e=this.polygon;if(!e)return!1;var n=e.findPoint(t);if(this.selectedPoint=n,e.length<3)return this.selectedPoint=e.add(t),this.triangulate(),!0;if(n>-1)return!1;for(var r=e.length,o=Number.MAX_SAFE_INTEGER,i=0;i<e.length;i++){var a=e.distFromEdge(t,i,i+1);a<o&&(o=a,r=i+1)}return this.selectedPoint=e.add(t,r),this.triangulate(),!0},t.prototype.removeDot=function(t,e){var n=this.polygon;if(n){var r=n.findPoint({x:t,y:e});r>-1&&(n.remove(r),this.triangulate())}},t.prototype.triangulate=function(){var t=this.polygon;this.triangles=t.triangulate(),this.paint(),window.sessionStorage.setItem("polygon",JSON.stringify(t))},Object.defineProperty(t.prototype,"image",{get:function(){return this._image},set:function(t){this._image=t,this.paint()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ctx",{get:function(){var t=this.canvas.getContext("2d");if(!t)throw Error("Unable to create 2D context!");return t},enumerable:!1,configurable:!0}),t.prototype.paint=function(){var t=this;window.requestAnimationFrame((function(){var e=t,n=e.ctx,r=e.image;e.polygon,n.canvas.width=Math.ceil(n.canvas.clientWidth),n.canvas.height=Math.ceil(n.canvas.clientHeight);var o=n.canvas.width,i=n.canvas.height,a=Math.min(o/r.width,i/r.height);t.scale=a,n.clearRect(0,0,o,i),n.save(),n.scale(a,a),t.xRayMode?t.paintXRay(n):t.paintDefault(n)}))},t.prototype.paintDefault=function(t){var e,n,r,o,i,a,l,s,c=this,u=c.data,h=c.image,f=c.polygon;t.save(),t.globalAlpha=.5,t.drawImage(h,0,0),t.globalAlpha=1,t.save(),t.beginPath();try{for(var A=U(u.getPolygonList()),g=A.next();!g.done;g=A.next()){var d=g.value,p=F(d.points),y=p[0],v=y.x,m=y.y,b=p.slice(1);t.moveTo(v,m);try{for(var E=(r=void 0,U(b)),x=E.next();!x.done;x=E.next()){var T=x.value,w=T.x,R=T.y;t.lineTo(w,R)}}catch(t){r={error:t}}finally{try{x&&!x.done&&(o=E.return)&&o.call(E)}finally{if(r)throw r.error}}t.lineTo(v,m)}}catch(t){e={error:t}}finally{try{g&&!g.done&&(n=A.return)&&n.call(A)}finally{if(e)throw e.error}}if(t.clip(),t.drawImage(h,0,0),t.restore(),f.points.length>0){t.strokeStyle="#000",t.lineWidth=3,t.beginPath();var B=F(f.points),I=B[0];v=I.x,m=I.y,b=B.slice(1),t.moveTo(v,m);try{for(var P=U(b),O=P.next();!O.done;O=P.next()){var C=O.value,_=C.x,L=C.y;t.lineTo(_,L)}}catch(t){i={error:t}}finally{try{O&&!O.done&&(a=P.return)&&a.call(P)}finally{if(i)throw i.error}}t.closePath(),t.stroke(),t.font="bold ".concat(Math.ceil(15),"px sans-serif"),t.textBaseline="middle",t.textAlign="center";var M=0;try{for(var S=U(f.points),D=S.next();!D.done;D=S.next()){var k=D.value,j=k.x,Q=k.y;t.fillStyle="#000",t.beginPath(),t.ellipse(j,Q,10,10,0,0,2*Math.PI),t.fill(),t.fillStyle="#fff",t.fillText("".concat(M++),j,Q)}}catch(t){l={error:t}}finally{try{D&&!D.done&&(s=S.return)&&s.call(S)}finally{if(l)throw l.error}}}t.restore()},t.prototype.paintXRay=function(t){var e,n,r=this.image,o=this.polygon;t.save(),t.globalAlpha=.1,t.drawImage(r,0,0),t.beginPath();var i=F(o.points),a=i[0],l=a.x,s=a.y,c=i.slice(1);t.moveTo(l,s);try{for(var u=U(c),h=u.next();!h.done;h=u.next()){var f=h.value,A=f.x,g=f.y;t.lineTo(A,g)}}catch(t){e={error:t}}finally{try{h&&!h.done&&(n=u.return)&&n.call(u)}finally{if(e)throw e.error}}t.closePath(),t.clip(),t.globalAlpha=1,t.drawImage(r,0,0),t.restore()},t}();const Q=j;var N=n(128),G={};G.styleTagTransform=p(),G.setAttributes=f(),G.insert=u().bind(null,"head"),G.domAPI=s(),G.insertStyleElement=g(),a()(N.Z,G),N.Z&&N.Z.locals&&N.Z.locals;var V=function(){return V=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},V.apply(this,arguments)};function Y(t){var e=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}(o.useState(t.value.name),2),n=e[0],i=e[1],a=t.value;return o.useEffect((function(){t.onNameChange(a.id,n)}),[n,a]),(0,r.jsxs)("div",V({className:H(t),title:"#".concat(a.id)},{children:[t.selected&&(0,r.jsx)("input",{value:n,autoFocus:!0,onChange:function(t){return i(function(t){var e,n,r="";try{for(var o=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(t),i=o.next();!i.done;i=o.next()){var a=i.value.toUpperCase();r+=a>="0"&&a<="9"||a>="A"&&a<="Z"?a:"_"}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return r!==t?r:t}(t.target.value))}}),!t.selected&&(0,r.jsx)("div",V({className:"label",onClick:function(){return t.onSelect(a.id)}},{children:t.value.name})),!t.selected&&(0,r.jsx)("button",V({className:"floating-button",onClick:function(){return t.onDelete(a.id)}},{children:(0,r.jsx)("svg",V({viewBox:"0 0 24 24"},{children:(0,r.jsx)("path",{fill:"currentColor",d:"M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19M8.46,11.88L9.87,10.47L12,12.59L14.12,10.47L15.53,11.88L13.41,14L15.53,16.12L14.12,17.53L12,15.41L9.88,17.53L8.47,16.12L10.59,14L8.46,11.88M15.5,4L14.5,3H9.5L8.5,4H5V6H19V4H15.5Z"})}))}))]}))}function H(t){var e=["custom","view-PolygonButtonView"];return"string"==typeof t.className&&e.push(t.className),t.selected&&e.push("selected"),e.join(" ")}var Z=n(242),W={};W.styleTagTransform=p(),W.setAttributes=f(),W.insert=u().bind(null,"head"),W.domAPI=s(),W.insertStyleElement=g(),a()(Z.Z,W),Z.Z&&Z.Z.locals&&Z.Z.locals;var X=n(142),J=n.n(X);function z(t){return"number"==typeof t}function q(t){return Array.isArray(t)}function K(t){return!!t&&!Array.isArray(t)&&"object"==typeof t}var $=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};function tt(t){var e,n;if(!K(t))return!1;if(!z(t.id))return!1;if(!function(t){return"string"==typeof t}(t.name))return!1;if(!q(t.points))return!1;try{for(var r=$(t.points),o=r.next();!o.done;o=r.next())if(!et(o.value))return!1}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}return!0}function et(t){return!!K(t)&&!!z(t.x)&&!!z(t.y)}var nt=function(){return nt=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},nt.apply(this,arguments)},rt="PolygonItems";var ot=function(){return ot=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},ot.apply(this,arguments)},it=function(){function t(t){var e=this;if(this.storage=t,this.save=S((function(){!function(t,e){t.setItem(rt,J().stringify(e.map((function(t,e){return nt(nt({},t),{id:e+1})}))))}(e.storage,e.polygonList)}),500),this.eventPolygonListChange=new x,this.eventCurrentPolygonChange=new x,this.polygonList=function(t){try{var e=t.getItem(rt);if(null===e)return[{id:1,name:"SPRITE_0",points:[]}];var n=J().parse(e);return function(t){var e,n;if(!q(t))return!1;try{for(var r=$(t),o=r.next();!o.done;o=r.next())if(!tt(o.value))return!1}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}return!0}(n)&&0!==n.length?n:[{id:1,name:"SPRITE_0",points:[]}]}catch(t){return console.error("Unable to retrieve PolygonItems:",t),[{id:1,name:"SPRITE_0",points:[]}]}}(t),0===this.polygonList.length)throw Error("PolygonItem list must never be empty!");this._currentPolygonId=this.polygonList[0].id}return t.getSingleton=function(){return t.instance||(t.instance=new t(window.localStorage)),t.instance},t.prototype.getPolygonList=function(){return this.polygonList.map((function(t){return ot({},t)}))},t.prototype.firePolygonListChanged=function(){this.eventPolygonListChange.fire(function(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))}([],function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}(this.polygonList),!1)),this.save()},Object.defineProperty(t.prototype,"currentPolygonId",{get:function(){return this._currentPolygonId},set:function(t){var e,n;try{for(var r=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(this.polygonList),o=r.next();!o.done;o=r.next())if(o.value.id===t)return this._currentPolygonId=t,void this.eventCurrentPolygonChange.fire(t)}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}},enumerable:!1,configurable:!0}),t.prototype.updatePolygon=function(t){var e=this,n=t.name,r=t.points,o=this.polygonList.find((function(t){return t.id===e.currentPolygonId}));if(o){var i=!1;r&&(o.points=r.map((function(t){return ot({},t)})),i=!0),n&&(this.findPolygonByName(n)||(o.name=n,i=!0)),i&&(this.firePolygonListChanged(),this.save())}},t.prototype.moveCurrentDown=function(){var t=this,e=this.polygonList,n=e.findIndex((function(e){return e.id===t.currentPolygonId}));if(!(n<0)){var r=this.getCurrentPolygon();if(n===e.length-1)return e.pop(),e.unshift(r),void this.firePolygonListChanged();e[n]=e[n+1],e[n+1]=r,this.firePolygonListChanged()}},t.prototype.moveCurrentUp=function(){var t=this,e=this.polygonList,n=e.findIndex((function(e){return e.id===t.currentPolygonId}));if(!(n<0)){var r=this.getCurrentPolygon();if(0===n)return e.shift(),e.push(r),void this.firePolygonListChanged();e[n]=e[n-1],e[n-1]=r,this.firePolygonListChanged()}},t.prototype.duplicateCurrentPolygon=function(){var t=this.getCurrentPolygon(),e=this.getFreeId(),n={id:e,name:this.makeNewPolygonName(),points:t.points.map((function(t){return ot({},t)}))};return this.polygonList.splice(this.getPolygonList().findIndex((function(e){return e.id===t.id}))+1,0,n),this.currentPolygonId=e,this.firePolygonListChanged(),n},t.prototype.removePolygonFromList=function(t){if(t===this.currentPolygonId)return!1;var e=this.polygonList.findIndex((function(e){return e.id===t}));return!(e<0||(this.polygonList.splice(e,1),this.firePolygonListChanged(),0))},t.prototype.getCurrentPolygon=function(){var t=this,e=this.polygonList.find((function(e){return e.id===t.currentPolygonId}));if(e)return ot({},e);if(console.error("There is no polygon with id #".concat(this.currentPolygonId,"!")),console.error("That means that the selected polygon has gone."),0===this.polygonList.length)throw Error("The polygon list is empty!");return this.currentPolygonId=this.polygonList[0].id,ot({},this.polygonList[0])},t.prototype.makeNewPolygonName=function(){for(var t=this.getCurrentPolygon(),e=/^([A-Z0-9_]*[A-Z_])([0-9]+)$/gi.exec(t.name),n=e?e[1]:"SPRITE_",r=e?parseInt(e[2]):0,o=r+1;o<r+9999;o++){var i="".concat(n).concat(o);if(!this.findPolygonByName(i))return i}return"".concat(n).concat(Date.now().toString(16))},t.prototype.findPolygonByName=function(t){var e=t.trim().toLowerCase();return this.polygonList.find((function(t){return t.name.trim().toLowerCase()===e}))},t.prototype.getFreeId=function(){return this.polygonList.map((function(t){return t.id})).reduce((function(t,e){return Math.max(t,e)}),0)+1},t}();const at=it,lt=o.createContext(at.getSingleton());var st=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a};function ct(){return o.useContext(lt)}var ut=function(){return ut=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},ut.apply(this,arguments)};function ht(t){var e=ct(),n=function(){var t=ct(),e=st(o.useState(t.getPolygonList()),2),n=e[0],r=e[1];return o.useEffect((function(){return t.eventPolygonListChange.add(r),function(){return t.eventPolygonListChange.remove(r)}}),[t]),n}(),i=function(){var t=ct(),e=st(o.useState(t.currentPolygonId),2),n=e[0],r=e[1];return o.useEffect((function(){return t.eventCurrentPolygonChange.add(r),function(){return t.eventCurrentPolygonChange.remove(r)}}),[t]),n}(),a=function(t){return e.removePolygonFromList(t)},l=function(t){e.currentPolygonId=t},s=function(t,n){e.updatePolygon({name:n})};return(0,r.jsxs)("div",ut({className:ft(t)},{children:[(0,r.jsx)("div",ut({className:"list"},{children:n.map((function(t){return(0,r.jsx)(Y,{selected:t.id===i,value:t,onSelect:l,onDelete:a,onNameChange:s},t.id)}))})),(0,r.jsx)("button",ut({onClick:function(){return e.duplicateCurrentPolygon()}},{children:"Duplicate Polygon (+)"}))]}))}function ft(t){var e=["custom","view-PolygonsListView"];return"string"==typeof t.className&&e.push(t.className),e.join(" ")}var At=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},gt=function(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))},dt=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};function pt(t,e){var n=t.getPolygonList(),r=function(t){var e,n,r,o,i=[],a=0;try{for(var l=dt(t.getPolygonList()),s=l.next();!s.done;s=l.next()){var c=s.value,u=[],h=new C(c.points).triangulate();try{for(var f=(r=void 0,dt(h)),A=f.next();!A.done;A=f.next()){var g=At(A.value,3),d=g[0],p=g[1],y=g[2];u.push(a+d,a+p,a+y)}}catch(t){r={error:t}}finally{try{A&&!A.done&&(o=f.return)&&o.call(f)}finally{if(r)throw r.error}}i.push(u),a+=c.points.length}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=l.return)&&n.call(l)}finally{if(e)throw e.error}}return i}(t);return yt(["export default class ".concat("Painter"," {"),gt(gt([],At(vt(t)),!1),["","private readonly prg: WebGLProgram","private readonly texBackground: WebGLTexture","private readonly texForeground: WebGLTexture","private readonly backBuff: WebGLBuffer","private readonly drawBuff: WebGLBuffer","private readonly elemBuff: WebGLBuffer","private readonly uniAspectRatioContain: WebGLUniformLocation","private readonly uniTexture: WebGLUniformLocation","private readonly vaoBackground: WebGLVertexArrayObject","private readonly vaoForeground: WebGLVertexArrayObject","private readonly offsets = [".concat(mt(r),"]"),"private readonly sizes = ".concat(JSON.stringify(r.map((function(t){return t.length})))),"private ratioImage = 1","","constructor(",["private readonly gl: WebGL2RenderingContext,","background: HTMLImageElement,","foreground: HTMLImageElement"],") {",["this.ratioImage = ensureSameAspectRatio(background, foreground)","// prettier-ignore","this.backBuff = this.createDrawBuffer([",["0, 1,","0, 0,","1, 0,","1, 0"],"])","// prettier-ignore","this.elemBuff = this.createElemBuffer([",r.map((function(t,e){return"".concat(t.join(", "),",  // ").concat(n[e].name)})),"])","// prettier-ignore","this.drawBuff = this.createDrawBuffer([",n.map((function(t,r){return"".concat(t.points.map((function(t){var n=t.x,r=t.y;return"".concat((n/e.width).toFixed(5),",").concat((r/e.height).toFixed(5))})).join(", "),",  // ").concat(n[r].name)})),"])","this.texBackground = this.createTexture(background)","this.texForeground = this.createTexture(foreground)","this.prg = createProgram(gl)","this.vaoBackground = this.createBackgroundVAO()","this.vaoForeground = this.createForegroundVAO()",'this.uniTexture = this.getUniformLocation("uniTexture")','this.uniAspectRatioContain = this.getUniformLocation("uniAspectRatioContain")'],"}","","draw(spriteIndexes: number[]) {",["const { gl, prg, vaoBackground, vaoForeground, ratioImage } = this","const w = gl.canvas.clientWidth","const h = gl.canvas.clientHeight","const { canvas } = gl","if (canvas.width !== w || canvas.height !== h) {",["const dpr = window.devicePixelRatio","canvas.width = w * dpr","canvas.height = h * dpr","gl.viewport(0, 0, w * dpr, h * dpr)"],"}","let ratioX = 1","let ratioY = 1","let scale = 1","const MARGIN_WIDE = 0.1","const MARGIN_NARROW = 0.005","const ratioScreen = w / h","const ratio = ratioImage / ratioScreen","if (w > h) {",["if (ratio > 1) ratioY = 1 / ratio","else ratioX = ratio","const w2 = w * (1 - MARGIN_WIDE)","const h2 = h * (1 - MARGIN_NARROW)","scale = Math.min(w2 / w, h2 / h)"],"} else {",["if (ratio > 1) ratioY = 1 / ratio","else ratioX = ratio","const w2 = w * (1 - MARGIN_NARROW)","const h2 = h * (1 - MARGIN_WIDE)","scale = Math.min(w2 / w, h2 / h)"],"}","ratioX *= scale","ratioY *= scale","gl.clearColor(0.733, 0.710, 0.655, 1)","gl.clear(gl.COLOR_BUFFER_BIT)","gl.disable(gl.DEPTH_TEST)","gl.disable(gl.BLEND)","gl.useProgram(prg)","gl.uniform2f(this.uniAspectRatioContain, ratioX, ratioY)","gl.activeTexture(gl.TEXTURE0)","gl.bindTexture(gl.TEXTURE_2D, this.texBackground)","gl.uniform1i(this.uniTexture, 0)","gl.bindVertexArray(vaoBackground)","gl.drawArrays(gl.TRIANGLE_FAN, 0, 4)","gl.bindVertexArray(null)","gl.enable(gl.BLEND)","gl.blendEquation(gl.FUNC_ADD)","gl.blendFuncSeparate(",["gl.SRC_ALPHA,","gl.ONE_MINUS_SRC_ALPHA,","gl.ZERO,","gl.ONE"],")","gl.useProgram(prg)","gl.uniform2f(this.uniAspectRatioContain, ratioX, ratioY)","gl.activeTexture(gl.TEXTURE0)","gl.bindTexture(gl.TEXTURE_2D, this.texForeground)","gl.uniform1i(this.uniTexture, 0)","gl.bindVertexArray(vaoForeground)","for (const index of spriteIndexes) {",["const offset = this.offsets[index]","const size = this.sizes[index]","gl.drawElements(gl.TRIANGLES, size, gl.UNSIGNED_SHORT, offset)"],"}","gl.bindVertexArray(null)"],"}","","private createDrawBuffer(data: number[]): WebGLBuffer {",["const { gl } = this","const buff = gl.createBuffer()",'if (!buff) throw Error("Unable to create a WebGLBuffer!")',"","gl.bindBuffer( gl.ARRAY_BUFFER, buff )","gl.bufferData(",["gl.ARRAY_BUFFER,","new Float32Array(data),","gl.STATIC_DRAW"],")","return buff"],"}","","private createElemBuffer(data: number[]): WebGLBuffer {",["const { gl } = this","const buff = gl.createBuffer()",'if (!buff) throw Error("Unable to create a WebGLBuffer!")',"","gl.bindBuffer( gl.ELEMENT_ARRAY_BUFFER, buff )","gl.bufferData(",["gl.ELEMENT_ARRAY_BUFFER,","new Uint16Array(data),","gl.STATIC_DRAW"],")","return buff"],"}","","private createTexture(img: HTMLImageElement): WebGLTexture {",["const { gl } = this","const tex = gl.createTexture()",'if (!tex) throw Error("Enable to create a WebGLTexture!")',"","gl.bindTexture(gl.TEXTURE_2D, tex)","gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR)","gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR)","gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE)","gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE)","gl.texImage2D(",["gl.TEXTURE_2D, 0,","gl.RGBA, gl.RGBA,","gl.UNSIGNED_BYTE,","img"],")","return tex"],"}","","private createForegroundVAO() {",["const { gl, prg } = this","const vao = gl.createVertexArray()",'if (!vao) throw Error("Unable to create a WebGLVertexArrayObject!")',"","gl.bindVertexArray(vao)","gl.bindBuffer(gl.ARRAY_BUFFER, this.drawBuff)","gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.elemBuff)",'const attUV = gl.getAttribLocation(prg, "attUV")',"gl.enableVertexAttribArray(attUV)","gl.vertexAttribPointer(attUV, 2, gl.FLOAT, false, 8, 0)","gl.bindVertexArray(null)","return vao"],"}","","private createBackgroundVAO() {",["const { gl, prg } = this","const vao = gl.createVertexArray()",'if (!vao) throw Error("Unable to create a WebGLVertexArrayObject!")',"","gl.bindVertexArray(vao)","gl.bindBuffer(gl.ARRAY_BUFFER, this.backBuff)",'const attUV = gl.getAttribLocation(prg, "attUV")',"gl.enableVertexAttribArray(attUV)","gl.vertexAttribPointer(attUV, 2, gl.FLOAT, false, 8, 0)","gl.bindVertexArray(null)","return vao"],"}","","private getUniformLocation(name: string) {",["const { gl, prg } = this","const loc = gl.getUniformLocation(prg, name)",'if (!loc) throw Error(`Unable to get uniform location for "${name}"!`)',"","return loc"],"}"],!1),"}","","interface Dimension {",["width: number","height: number"],"}","","function ensureSameAspectRatio(img1: Dimension, img2: Dimension): number {",["const ratio1 = img1.width / img1.height","const ratio2 = img2.width / img2.height","if (Math.abs(ratio1 - ratio2) > 1e-3) {",['throw Error("Background and foregroung must have the same aspect ratio!")'],"}","return ratio1"],"}","","function createProgram(gl: WebGL2RenderingContext) {",["const prg = gl.createProgram()",'if (!prg) throw Error("Unable to create WebGL Program!")',"","const vertShader = gl.createShader(gl.VERTEX_SHADER)",'if (!vertShader) throw Error("Unable to create a Vertex Shader handle!")',"","gl.shaderSource(vertShader, VERT)","gl.compileShader(vertShader)","gl.attachShader(prg, vertShader)","const fragShader = gl.createShader(gl.FRAGMENT_SHADER)",'if (!fragShader) throw Error("Unable to create a Fragment Shader handle!")',"","gl.shaderSource(fragShader, FRAG)","gl.compileShader(fragShader)","gl.attachShader(prg, fragShader)","gl.linkProgram(prg)","return prg"],"}","","const VERT = `".concat("#version 300 es\n\nuniform vec2 uniAspectRatioContain;\nin vec2 attUV;\nout vec2 varUV;\n\nvoid main() {\n    varUV = attUV;\n    vec2 point = vec2(2.0 * attUV.x - 1.0, 1.0 - 2.0 * attUV.y);\n    gl_Position = vec4(point * uniAspectRatioContain, 0.5, 1.0);\n}\n".trim(),"`"),"const FRAG = `".concat("#version 300 es\n\nprecision mediump float;\n\nuniform sampler2D uniTexture;\nin vec2 varUV;\nout vec4 FragColor;\n\nvoid main() {\n    FragColor = texture( uniTexture, varUV );\n}\n".trim(),"`")])}function yt(t,e){return void 0===e&&(e=""),t.map((function(t){return"string"==typeof t?"".concat(e).concat(t):yt(t,"".concat(e,"    "))})).join("\n")}function vt(t){return t.getPolygonList().map((function(t,e){return"static ".concat(t.name.toUpperCase()," = ").concat(e)}))}function mt(t){var e=0;return t.map((function(t){var n=e;return e+=t.length,n*Uint16Array.BYTES_PER_ELEMENT}))}function bt(t,e){var n=t.getPolygonList(),r=n.findIndex((function(e){return e.id===t.currentPolygonId}));if(!(r<0)){var o=(r+e+n.length)%n.length;t.currentPolygonId=n[o].id}}var Et=n(961),xt={};xt.styleTagTransform=p(),xt.setAttributes=f(),xt.insert=u().bind(null,"head"),xt.domAPI=s(),xt.insertStyleElement=g(),a()(Et.Z,xt),Et.Z&&Et.Z.locals&&Et.Z.locals;var Tt=function(){return Tt=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},Tt.apply(this,arguments)};function wt(t){var e=ct(),n=o.useRef(new Q(e));return function(t){o.useEffect((function(){var e=function(e){var n=(e.shiftKey?1:0)+(e.ctrlKey?2:0)+(e.altKey?4:0);switch(console.log("🚀 [polygons-order] evt.key = ",e.key),e.key){case"ArrowDown":e.preventDefault(),e.stopPropagation(),0===n?bt(t,1):t.moveCurrentDown();break;case"ArrowUp":e.preventDefault(),e.stopPropagation(),0===n?bt(t,-1):t.moveCurrentUp();break;case"+":0===n&&(e.preventDefault(),e.stopPropagation(),t.duplicateCurrentPolygon())}};return window.document.addEventListener("keydown",e,!0),function(){return window.document.removeEventListener("keydown",e,!0)}}),[t])}(e),function(t,e){var n=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}(o.useState(-1),2),r=(n[0],n[1]);o.useEffect((function(){var n=function(){console.log("🚀 [selection] data.currentPolygonId = ",t.currentPolygonId),r(t.currentPolygonId),e.resetPolygon(t.getCurrentPolygon())};return t.eventCurrentPolygonChange.add(n),function(){return t.eventCurrentPolygonChange.remove(n)}}),[t,e])}(e,n.current),o.useEffect((function(){var t=new Image;t.src=E,t.onload=function(){n.current.image=t}}),[]),o.useEffect((function(){var t=n.current,r=function(){return e.updatePolygon({points:t.polygon.points})};return t.polygon.eventChange.add(r),t.resetPolygon(e.getCurrentPolygon()),function(){return t.polygon.eventChange.remove(r)}}),[e,n.current]),(0,r.jsxs)("div",Tt({className:Rt(t)},{children:[(0,r.jsx)(m,{painter:n.current}),(0,r.jsxs)("aside",{children:[(0,r.jsx)("button",{children:"Load Image"}),(0,r.jsx)(ht,{}),(0,r.jsx)("button",Tt({onClick:function(){var t=pt(e,n.current.image);console.log(t),navigator.clipboard.writeText(t)}},{children:"Export Code"}))]})]}))}function Rt(t){var e=["custom","App"];return"string"==typeof t.className&&e.push(t.className),e.join(" ")}var Bt=function(){return Bt=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},Bt.apply(this,arguments)};function It(){return(0,r.jsx)(lt.Provider,Bt({value:at.getSingleton()},{children:(0,r.jsx)(wt,{})}))}var Pt=n(745);const Ot=n.p+"./img/background.4e2e13c4372e9ef697ad.webp",Ct=n.p+"./img/frame.108bd4bbee931109f4c7.webp";var _t=new Map,Lt=new Map,Mt=function(){function t(t,e,n,r){this.gl=t,this.offsets=[0,36,66,102,138,150,162,174,186,198,210,222,234,246,258,270,282,294,306,318,330,342,354,366],this.sizes=[18,15,18,18,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],this.ratioImage=1,this.ratioImage=function(t,e){var n=t.width/t.height,r=e.width/e.height;if(Math.abs(n-r)>.001)throw Error("Background and sprites images must have the same aspect ratio!");return n}(e,n),this.backBuff=this.createDrawBuffer([0,1,0,0,1,0,1,1]),this.elemBuff=this.createElemBuffer([0,1,2,0,2,3,0,3,4,0,4,5,7,0,5,5,6,7,14,8,9,14,9,10,14,10,11,14,11,12,12,13,14,22,15,16,22,16,17,22,17,18,22,18,19,22,19,20,20,21,22,30,23,24,30,24,25,30,25,26,30,26,27,30,27,28,28,29,30,34,31,32,32,33,34,38,35,36,36,37,38,42,39,40,40,41,42,46,43,44,44,45,46,50,47,48,48,49,50,54,51,52,52,53,54,58,55,56,56,57,58,62,59,60,60,61,62,66,63,64,64,65,66,70,67,68,68,69,70,74,71,72,72,73,74,78,75,76,76,77,78,82,79,80,80,81,82,86,83,84,84,85,86,90,87,88,88,89,90,94,91,92,92,93,94,98,95,96,96,97,98,102,99,100,100,101,102,106,103,104,104,105,106,110,107,108,108,109,110]),this.drawBuff=this.createDrawBuffer([.50082,.34711,.50156,.58489,.37113,.58696,.37651,.50932,.34558,.45756,.33751,.37992,.29314,.36335,.29247,.34369,.70234,.34279,.70125,.36335,.65956,.38199,.65889,.43892,.62595,.59524,.50156,.5766,.49955,.34576,.7073,.74948,.7073,.77226,.65486,.78882,.65419,.84679,.6199,.89855,.62527,.98344,.50291,.98137,.50096,.75073,.28987,.75155,.29045,.77433,.34558,.78882,.34491,.84472,.37853,.89648,.3792,.99172,.50224,.99172,.50089,.75362,.00336,.18116,.00383,.33183,.10825,.32919,.10757,.17909,.20775,.15839,.20977,.3499,.10959,.34576,.11026,.16563,.30524,.18737,.2965,.34265,.21717,.33644,.21985,.19048,.36979,.34576,.31869,.34679,.31802,.19255,.3718,.19772,.50224,.17391,.49686,.3499,.39668,.34576,.39601,.17805,.59031,.18116,.59099,.33644,.52711,.33954,.5251,.18841,.67973,.1853,.67973,.34161,.61317,.34369,.61519,.18737,.78344,.18302,.78529,.34369,.70259,.33644,.70239,.18302,.90093,.19151,.87807,.33644,.80479,.34058,.80344,.19669,.98027,.17391,.99708,.3499,.9036,.34611,.90362,.17909,.9796,.73913,.90564,.73602,.90362,.58489,.9722,.58696,.88681,.57246,.88816,.75673,.78798,.75362,.78596,.56832,.77655,.74845,.69654,.74741,.69443,.59556,.76714,.59627,.67906,.60352,.68511,.75362,.62124,.75155,.62259,.60766,.59368,.59213,.60578,.74224,.5056,.75776,.49417,.57867,.46593,.59213,.47131,.74845,.40542,.74948,.40266,.58978,.37449,.74948,.32205,.74845,.32138,.59938,.37382,.60352,.29179,.58592,.29029,.75302,.20708,.74741,.20708,.58903,.20103,.75052,.11295,.74741,.10403,.59435,.18825,.59524,.08808,.57557,.09682,.74638,.00134,.7588,.00538,.58282]),this.texBackground=this.createTexture(e),this.texSprites=this.createTexture(n),this.texForeground=this.createTexture(r),this.prg=function(t){var e=t.createProgram();if(!e)throw Error("Unable to create WebGL Program!");var n=t.createShader(t.VERTEX_SHADER);if(!n)throw Error("Unable to create a Vertex Shader handle!");t.shaderSource(n,Dt),t.compileShader(n),t.attachShader(e,n);var r=t.createShader(t.FRAGMENT_SHADER);if(!r)throw Error("Unable to create a Fragment Shader handle!");return t.shaderSource(r,kt),t.compileShader(r),t.attachShader(e,r),t.linkProgram(e),e}(t),this.vaoBackground=this.createBackgroundVAO(),this.vaoForeground=this.createForegroundVAO(),this.uniTexture=this.getUniformLocation("uniTexture"),this.uniAspectRatioContain=this.getUniformLocation("uniAspectRatioContain")}return t.prototype.draw=function(t){var e,n,r=this,o=r.gl,i=r.prg,a=r.vaoBackground,l=r.vaoForeground,s=r.ratioImage,c=o.canvas.clientWidth,u=o.canvas.clientHeight,h=o.canvas;if(h.width!==c||h.height!==u){var f=window.devicePixelRatio;h.width=c*f,h.height=u*f,o.viewport(0,0,c*f,u*f)}var A=1,g=1,d=1,p=s/(c/u);if(c>u){p>1?g=1/p:A=p;var y=.9*c,v=.995*u;d=Math.min(y/c,v/u)}else p>1?g=1/p:A=p,y=.995*c,v=.9*u,d=Math.min(y/c,v/u);A*=d,g*=d,o.clearColor(.25,.5,.447,1),o.clear(o.COLOR_BUFFER_BIT),o.disable(o.DEPTH_TEST),o.useProgram(i),o.disable(o.BLEND),o.uniform2f(this.uniAspectRatioContain,A,g),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,this.texBackground),o.uniform1i(this.uniTexture,0),o.bindVertexArray(a),o.drawArrays(o.TRIANGLE_FAN,0,4),o.bindVertexArray(null),o.enable(o.BLEND),o.blendEquation(o.FUNC_ADD),o.blendFuncSeparate(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA,o.ZERO,o.ONE),o.uniform2f(this.uniAspectRatioContain,A,g),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,this.texSprites),o.uniform1i(this.uniTexture,0),o.bindVertexArray(l);try{for(var m=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(t),b=m.next();!b.done;b=m.next()){var E=b.value,x=this.offsets[E],T=this.sizes[E];o.drawElements(o.TRIANGLES,T,o.UNSIGNED_SHORT,x)}}catch(t){e={error:t}}finally{try{b&&!b.done&&(n=m.return)&&n.call(m)}finally{if(e)throw e.error}}o.bindVertexArray(null),o.uniform2f(this.uniAspectRatioContain,1.1*A,1.1*g),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,this.texForeground),o.uniform1i(this.uniTexture,0),o.bindVertexArray(a),o.drawArrays(o.TRIANGLE_FAN,0,4),o.bindVertexArray(null)},t.prototype.createDrawBuffer=function(t){var e=this.gl,n=e.createBuffer();if(!n)throw Error("Unable to create a WebGLBuffer!");return e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t),e.STATIC_DRAW),n},t.prototype.createElemBuffer=function(t){var e=this.gl,n=e.createBuffer();if(!n)throw Error("Unable to create a WebGLBuffer!");return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(t),e.STATIC_DRAW),n},t.prototype.createTexture=function(t){var e=this.gl,n=e.createTexture();if(!n)throw Error("Enable to create a WebGLTexture!");return e.bindTexture(e.TEXTURE_2D,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),n},t.prototype.createForegroundVAO=function(){var t=this.gl,e=this.prg,n=t.createVertexArray();if(!n)throw Error("Unable to create a WebGLVertexArrayObject!");t.bindVertexArray(n),t.bindBuffer(t.ARRAY_BUFFER,this.drawBuff),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.elemBuff);var r=t.getAttribLocation(e,"attUV");return t.enableVertexAttribArray(r),t.vertexAttribPointer(r,2,t.FLOAT,!1,8,0),t.bindVertexArray(null),n},t.prototype.createBackgroundVAO=function(){var t=this.gl,e=this.prg,n=t.createVertexArray();if(!n)throw Error("Unable to create a WebGLVertexArrayObject!");t.bindVertexArray(n),t.bindBuffer(t.ARRAY_BUFFER,this.backBuff);var r=t.getAttribLocation(e,"attUV");return t.enableVertexAttribArray(r),t.vertexAttribPointer(r,2,t.FLOAT,!1,8,0),t.bindVertexArray(null),n},t.prototype.getUniformLocation=function(t){var e=this.gl,n=this.prg,r=e.getUniformLocation(n,t);if(!r)throw Error('Unable to get uniform location for "'.concat(t,'"!'));return r},t.RICK_TOP_LEFT=0,t.RICK_TOP_RIGHT=1,t.RICK_BOTTOM_RIGHT=2,t.RICK_BOTTOM_LEFT=3,t.MORTY_TOP_0=4,t.MORTY_TOP_1=5,t.MORTY_TOP_2=6,t.MORTY_TOP_3=7,t.MORTY_TOP_4=8,t.MORTY_TOP_5=9,t.MORTY_TOP_6=10,t.MORTY_TOP_7=11,t.MORTY_TOP_8=12,t.MORTY_TOP_9=13,t.MORTY_BOTTOM_0=14,t.MORTY_BOTTOM_1=15,t.MORTY_BOTTOM_2=16,t.MORTY_BOTTOM_3=17,t.MORTY_BOTTOM_4=18,t.MORTY_BOTTOM_5=19,t.MORTY_BOTTOM_6=20,t.MORTY_BOTTOM_7=21,t.MORTY_BOTTOM_8=22,t.MORTY_BOTTOM_9=23,t}();const St=Mt;var Dt="#version 300 es\n\nuniform vec2 uniAspectRatioContain;\nin vec2 attUV;\nout vec2 varUV;\n\nvoid main() {\n    varUV = attUV;\n    vec2 point = vec2(2.0 * attUV.x - 1.0, 1.0 - 2.0 * attUV.y);\n    gl_Position = vec4(point * uniAspectRatioContain, 0.5, 1.0);\n}",kt="#version 300 es\n\nprecision mediump float;\n\nuniform sampler2D uniTexture;\nin vec2 varUV;\nout vec4 FragColor;\n\nvoid main() {\n    FragColor = texture( uniTexture, varUV );\n}",Ut=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Ft=function(){function t(t){this.paths=t,this.sprites=new Set}return t.prototype.clear=function(){for(var t,e,n,r,o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];var a=this,l=a.paths,s=a.sprites;0===o.length&&(o=Object.keys(o));try{for(var c=Ut(o.map((function(t){return l[t]}))),u=c.next();!u.done;u=c.next()){var h=u.value;try{for(var f=(n=void 0,Ut(h)),A=f.next();!A.done;A=f.next()){var g=A.value;Qt(g,(function(t){return s.delete(t)}))}}catch(t){n={error:t}}finally{try{A&&!A.done&&(r=f.return)&&r.call(f)}finally{if(n)throw n.error}}}}catch(e){t={error:e}}finally{try{u&&!u.done&&(e=c.return)&&e.call(c)}finally{if(t)throw t.error}}},t.prototype.isOn=function(t,e){var n,r;void 0===e&&(e=0),this.paths;var o=this.sprites,i=this.getPathStep(t,e);try{for(var a=Ut(i),l=a.next();!l.done;l=a.next()){var s=l.value;if(!o.has(s))return!1}}catch(t){n={error:t}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return!0},t.prototype.isOff=function(t,e){return void 0===e&&(e=0),!this.isOn(t,e)},t.prototype.list=function(){return Array.from(this.sprites)},t.prototype.on=function(t){for(var e,n,r,o,i=[],a=1;a<arguments.length;a++)i[a-1]=arguments[a];var l=this,s=l.paths,c=l.sprites,u=s[t];0===i.length&&(i=u.map((function(t,e){return e})));try{for(var h=Ut(i),f=h.next();!f.done;f=h.next()){var A=f.value,g=this.getPathStep(t,A);try{for(var d=(r=void 0,Ut(g)),p=d.next();!p.done;p=d.next()){var y=p.value;c.add(y)}}catch(t){r={error:t}}finally{try{p&&!p.done&&(o=d.return)&&o.call(d)}finally{if(r)throw r.error}}}}catch(t){e={error:t}}finally{try{f&&!f.done&&(n=h.return)&&n.call(h)}finally{if(e)throw e.error}}},t.prototype.off=function(t){for(var e,n,r,o,i=[],a=1;a<arguments.length;a++)i[a-1]=arguments[a];var l=this,s=l.paths,c=l.sprites,u=s[t];0===i.length&&(i=u.map((function(t,e){return e})));try{for(var h=Ut(i),f=h.next();!f.done;f=h.next()){var A=f.value,g=this.getPathStep(t,A);try{for(var d=(r=void 0,Ut(g)),p=d.next();!p.done;p=d.next()){var y=p.value;c.delete(y)}}catch(t){r={error:t}}finally{try{p&&!p.done&&(o=d.return)&&o.call(d)}finally{if(r)throw r.error}}}}catch(t){e={error:t}}finally{try{f&&!f.done&&(n=h.return)&&n.call(h)}finally{if(e)throw e.error}}},t.prototype.getPathStep=function(t,e){var n=this.paths[t];if(e<0||e>=n.length)throw Error("Step ".concat(e,' is out of bounds for path "').concat(t,'"!'));var r=n[e];return Array.isArray(r)?r:[r]},t}();const jt=Ft;function Qt(t,e){var n,r;if(Array.isArray(t))try{for(var o=Ut(t),i=o.next();!i.done;i=o.next())e(i.value)}catch(t){n={error:t}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}else e(t)}var Nt=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},Gt=function(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))},Vt=10,Yt=function(){function t(t){var e=this;this.painter=t,this.sprites=new jt({rickTopLeft:[St.RICK_TOP_LEFT],rickTopRight:[St.RICK_TOP_RIGHT],rickBotLeft:[St.RICK_BOTTOM_LEFT],rickBotRight:[St.RICK_BOTTOM_RIGHT],rick:[St.RICK_TOP_LEFT,St.RICK_TOP_RIGHT,St.RICK_BOTTOM_RIGHT,St.RICK_BOTTOM_LEFT],mortyTop:[St.MORTY_TOP_0,St.MORTY_TOP_1,St.MORTY_TOP_2,St.MORTY_TOP_3,St.MORTY_TOP_4,St.MORTY_TOP_5,St.MORTY_TOP_6,St.MORTY_TOP_7,St.MORTY_TOP_8,St.MORTY_TOP_9],mortyBot:[St.MORTY_BOTTOM_0,St.MORTY_BOTTOM_1,St.MORTY_BOTTOM_2,St.MORTY_BOTTOM_3,St.MORTY_BOTTOM_4,St.MORTY_BOTTOM_5,St.MORTY_BOTTOM_6,St.MORTY_BOTTOM_7,St.MORTY_BOTTOM_8,St.MORTY_BOTTOM_9]}),this.eventScoreUpdate=new x,this.eventMiss=new x,this.rickIndex=0,this.lastTopTick=-1,this.lastBotTick=-1,this.time=0,this.mode="play",this.cinematic=[],this.inputHandler=function(t){if("play"===e.mode)switch(t){case"left":return e.moveRickLeft();case"right":return e.moveRickRight()}},function(t){if(!_t.has(t)){var e=function(e){switch(e.key){case"ArrowRight":t("right");break;case"ArrowLeft":t("left")}};document.addEventListener("keydown",e,!0),_t.set(t,e)}if(!Lt.has(t)){var n=function(e){var n=window.document.body.getBoundingClientRect(),r=n.width,o=n.height;e.clientY<o/2||(e.clientX<r/2?t("left"):t("right"))};document.addEventListener("pointerdown",n,!0),Lt.set(t,n)}}(this.inputHandler);var n=-11-Wt(0,2),r=n-Vt-Wt(0,2);this.mortyTopIndexes=[-1,n,r];var o=Wt(-2,-7),i=o-Vt-Wt(0,2),a=i-Vt-Wt(0,2);this.mortyBotIndexes=[o,i,a],this.sprites.on("rick",this.rickIndex)}return t.prototype.play=function(t){if(this.time=t,"play"===this.mode)return this.playMortyTop(t),void this.playMortyBot(t);var e=this.cinematic;if(0===e.length)return this.mode="play",void this.eventMiss.fire();for(;e.length>0;){var n=Nt(e[0],2),r=n[0],o=n[1];if(r>t)break;e.shift(),o()}},t.prototype.onMorty=function(t){var e;this.sprites.clear(t);var n=("mortyTop"===t?this.mortyTopIndexes:this.mortyBotIndexes).filter((function(t){return t>=0&&t<Vt}));0!==n.length&&(e=this.sprites).on.apply(e,Gt([t],Nt(n),!1))},t.prototype.addToScore=function(t){this.eventScoreUpdate.fire(t)},t.prototype.playMortyTop=function(t){var e=this,n=Math.floor(.001*t);n!==this.lastTopTick&&(this.lastTopTick=n,this.moveMorty(this.mortyTopIndexes,(function(t){if(3===t){if(e.sprites.isOff("rickTopLeft"))return e.createCinematic("mortyTop",t),!0;e.addToScore(1)}else if(6===t){if(e.sprites.isOff("rickTopRight"))return e.createCinematic("mortyTop",t),!0;e.addToScore(1)}return!1})),this.onMorty("mortyTop"))},t.prototype.playMortyBot=function(t){var e=this,n=Math.floor(.001*(t+500));n!==this.lastBotTick&&(this.lastBotTick=n,this.moveMorty(this.mortyBotIndexes,(function(t){if(3===t){if(e.sprites.isOff("rickBotRight"))return e.createCinematic("mortyBot",t),!0;e.addToScore(1)}else if(6===t){if(e.sprites.isOff("rickBotLeft"))return e.createCinematic("mortyBot",t),!0;e.addToScore(1)}return!1})),this.onMorty("mortyBot"))},t.prototype.moveMorty=function(t,e){for(var n=0;n<t.length;n++){var r=t[n]+1;t[n]=r,e(r)}var o=t.filter((function(t){return t<Vt}));if(o.length!==t.length){for(;o.length<t.length;)Zt(o);t.splice.apply(t,Gt([0,t.length],Nt(o),!1))}},t.prototype.moveRickRight=function(){switch(this.rickIndex){case 0:case 2:this.rickIndex=1;break;case 1:case 3:this.rickIndex=2}this.paintRick()},t.prototype.moveRickLeft=function(){switch(this.rickIndex){case 0:case 2:this.rickIndex=3;break;case 1:case 3:this.rickIndex=0}this.paintRick()},t.prototype.paintRick=function(){this.sprites.clear("rick"),this.sprites.on("rick",this.rickIndex)},t.prototype.createCinematic=function(t,e){var n=this;this.resetCinematic(),this.addToCinematic(0,(function(){return n.sprites.on(t,e)}));for(var r=0;r<4;r++)this.addToCinematic(300,(function(){return n.sprites.off(t,e)})),this.addToCinematic(300,(function(){return n.sprites.on(t,e)}));this.addToCinematic(300,(function(){n.sprites.off(t,e),n.resetMorties()}))},t.prototype.resetCinematic=function(){this.cinematic=[],this.mode="look"},t.prototype.addToCinematic=function(t,e){if(0!==this.cinematic.length){var n=Nt(this.cinematic.at(-1),1)[0];this.cinematic.push([n+t,e])}else this.cinematic.push([t+this.time,e])},t.prototype.resetMorties=function(){this.resetMortyIndexes(this.mortyTopIndexes),this.resetMortyIndexes(this.mortyBotIndexes)},t.prototype.resetMortyIndexes=function(t){t.splice(0,t.length);for(var e=0;e<3;e++)Zt(t)},t}();const Ht=Yt;function Zt(t){for(var e=Math.min(0,t.reduce((function(t,e){return Math.min(t,e)}),Number.MAX_SAFE_INTEGER));;){var n=e-Wt(1,Vt);if(!t.includes(n+3))return void t.push(n)}}function Wt(t,e){return t+Math.floor(Math.random()*(e-t))}var Xt=n(904),Jt={};Jt.styleTagTransform=p(),Jt.setAttributes=f(),Jt.insert=u().bind(null,"head"),Jt.domAPI=s(),Jt.insertStyleElement=g(),a()(Xt.Z,Jt),Xt.Z&&Xt.Z.locals&&Xt.Z.locals;var zt=function(){return zt=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},zt.apply(this,arguments)},qt=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(t){i(t)}}function l(t){try{s(r.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,l)}s((r=r.apply(t,e||[])).next())}))},Kt=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}};function $t(){return(0,r.jsxs)("div",zt({className:"game"},{children:[(0,r.jsx)("canvas",{ref:te}),(0,r.jsx)("div",zt({id:"score"},{children:"0"})),(0,r.jsx)("div",{className:"button-red left"}),(0,r.jsx)("div",{className:"button-red right"})]}))}function te(t){return qt(this,void 0,void 0,(function(){var e,n,r,o,i,a,l,s;return Kt(this,(function(c){switch(c.label){case 0:if(!(e=document.getElementById("score")))throw Error("Missing div with id score!");if(!(n=t.getContext("webgl2",{antialias:!1})))throw Error("Unable to create WebGL2RenderingContext!");return o=St.bind,i=[void 0,n],[4,ee(Ot)];case 1:return i=i.concat([c.sent()]),[4,ee(E)];case 2:return i=i.concat([c.sent()]),[4,ee(Ct)];case 3:return r=new(o.apply(St,i.concat([c.sent()]))),a=0,(l=new Ht(r)).eventScoreUpdate.add((function(t){a=Math.max(0,a+t),e.textContent="".concat(a)})),l.eventMiss.add((function(){a=Math.max(0,a-5),e.textContent="".concat(a)})),s=function(t){l.play(t),r.draw(l.sprites.list()),window.requestAnimationFrame(s)},window.requestAnimationFrame(s),[2]}}))}))}function ee(t){return qt(this,void 0,void 0,(function(){return Kt(this,(function(e){return[2,new Promise((function(e){var n=new Image;n.src=t,n.onload=function(){console.log("Loaded:",t),e(n)},n.onerror=function(){console.error("Unable to load:",t),e(n)}}))]}))}))}var ne=n(788),re={};re.styleTagTransform=p(),re.setAttributes=f(),re.insert=u().bind(null,"head"),re.domAPI=s(),re.insertStyleElement=g(),a()(ne.Z,re),ne.Z&&ne.Z.locals&&ne.Z.locals;function oe(){return console.log("🚀 [index] window.location.hash = ",window.location.hash),"#edit"===window.location.hash?(0,r.jsx)(It,{}):(0,r.jsx)($t,{})}!function(){var t,e,n,o;t=this,e=void 0,o=function(){var t;return function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}(this,(function(e){if(!(t=document.getElementById("app")))throw Error('No element with id "app"!');return(0,Pt.s)(t).render((0,r.jsx)(oe,{})),[2]}))},new((n=void 0)||(n=Promise))((function(r,i){function a(t){try{s(o.next(t))}catch(t){i(t)}}function l(t){try{s(o.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,l)}s((o=o.apply(t,e||[])).next())}))}()},715:(t,e,n)=>{t.exports=n.p+"./img/button-red.596c2e150989d08b0439.webp"},134:t=>{t.exports="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEBLAEsAAD//gATQ3JlYXRlZCB3aXRoIEdJTVD/4gKwSUNDX1BST0ZJTEUAAQEAAAKgbGNtcwQwAABtbnRyUkdCIFhZWiAH5gALAAcACQAQAAVhY3NwQVBQTAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA9tYAAQAAAADTLWxjbXMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA1kZXNjAAABIAAAAEBjcHJ0AAABYAAAADZ3dHB0AAABmAAAABRjaGFkAAABrAAAACxyWFlaAAAB2AAAABRiWFlaAAAB7AAAABRnWFlaAAACAAAAABRyVFJDAAACFAAAACBnVFJDAAACFAAAACBiVFJDAAACFAAAACBjaHJtAAACNAAAACRkbW5kAAACWAAAACRkbWRkAAACfAAAACRtbHVjAAAAAAAAAAEAAAAMZW5VUwAAACQAAAAcAEcASQBNAFAAIABiAHUAaQBsAHQALQBpAG4AIABzAFIARwBCbWx1YwAAAAAAAAABAAAADGVuVVMAAAAaAAAAHABQAHUAYgBsAGkAYwAgAEQAbwBtAGEAaQBuAABYWVogAAAAAAAA9tYAAQAAAADTLXNmMzIAAAAAAAEMQgAABd7///MlAAAHkwAA/ZD///uh///9ogAAA9wAAMBuWFlaIAAAAAAAAG+gAAA49QAAA5BYWVogAAAAAAAAJJ8AAA+EAAC2xFhZWiAAAAAAAABilwAAt4cAABjZcGFyYQAAAAAAAwAAAAJmZgAA8qcAAA1ZAAAT0AAACltjaHJtAAAAAAADAAAAAKPXAABUfAAATM0AAJmaAAAmZwAAD1xtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAAgAAAAcAEcASQBNAFBtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAAgAAAAcAHMAUgBHAEL/2wBDAAUDBAQEAwUEBAQFBQUGBwwIBwcHBw8LCwkMEQ8SEhEPERETFhwXExQaFRERGCEYGh0dHx8fExciJCIeJBweHx7/2wBDAQUFBQcGBw4ICA4eFBEUHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh7/wgARCAEAAQADAREAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAQACBf/EABcBAQEBAQAAAAAAAAAAAAAAAAABAgX/2gAMAwEAAhADEAAAAeFrkoEZEDRkhIiIjQEAjREREaszKCQCBAJCZI0REIDREBEREaMmqzCRENEZI0Q1mIQEhqIoCKiEhqCGsxCQERlVEhADQCBqoigAQIhAhACEDQAQiRkhIRqFMywERCQCQ1mIiAQBQ0iJkSISGkzEBEBoBEyREBEIAQmwMGiEiqhohAgIQISIAIBN0RkhEjIkJAI1FGRMiQgRCACRCQEAiREVUAjQUBERCQEIEJGRICEhASGiA1VFRAJAQkBCQEQCREJERDUEBqylCA0AEIEQkAEJAQkQgaAazEapQWMxGjJCBAJARCREQgJEREBqoIaIiIaowJEAkAkQGiAgEQATVERAAkQ0RqiAiIyaEyJCZEiECI1UEQAQgICAkQEboiIiASEBqMxqiIaIgIDRkRKiEgEiARoiIiNWZlBIhAjIgaMkJEREaoiAiIiNGTVZhIgECASEyRoiIQGqAiohIaghrMQkQ0RkjRDWYhASGoigAQIhAhACEiIyqiQgBoBA1UEQERCQCQ1mIiA0AEIkZISEahTMsBEBoBEyREBEIAoaREyJEJDSZhAgIQISIAIBEAITYGDRCRVQ1FGRMiQgRCACQG6IyQiRkSEgEaCgIiISAhAhIBICARIiKqARqCASAhICEgIgEgISEBIaIDVUBAaACECISACISIhIiIaggNWUtUZiNGSECASAiEgISIQNANZiNUpmVoiIhqjAkQCQCREQgJEREBqoIgASIaI1RAREZNEQGiAgEQATVERABCAgICRAQiZEhMiRCBEaqCGiICA0ZESohIDVEREQCQgNRmNUR//EABoQAQEBAQEBAQAAAAAAAAAAAAEwQFAgYBD/2gAIAQEAAQUC/CJofR2z2SdhwCDkfB9AcA1vog0cjR4DlKkiDoImh9HMbns9HAIOg2PwhwDgkHE2aPAcpNoQbEP/xAAUEQEAAAAAAAAAAAAAAAAAAACg/9oACAEDAQE/AQAf/8QAFBEBAAAAAAAAAAAAAAAAAAAAoP/aAAgBAgEBPwEAH//EABQQAQAAAAAAAAAAAAAAAAAAAKD/2gAIAQEABj8CAB//xAAcEAADAAMBAQEAAAAAAAAAAAAAARARIEExITD/2gAIAQEAAT8hnofsxXH5DFEPRMyNiEzJkQ/dH7F6ILX0MSiRgxr0fhwUx81Yr2KodTqfyodcQvTJ2dFFEIerItS8ORDihi1ZmJ1DFGYiivDlMQo/BCij07FVooqh+GdTHEj40X4IdUVcOV3RxDrjnTmirFoxVHZ0f5YOxaoYooxVHZ0Y1sxR+GYvItVEMQtHTBi40QxGTJ2KodVfotS9no9lr7otEKKEKdF4eh+iHOaEZqFotGTIxD9FMxeTu6bYq0cuRMb+iHUL0b+mTJkyZ+1aMSqEOOCuPpj6JfRmIhej9MGJyuGYMaYEYH5FgQwMSO7ejp2oYoWj9HomZGxCZkyIfu3ofsxXH5DFFr0fhwUx81Yh+xeiC19DEokYMRDriF6ZOzoor2KodTqfyocUMWrMxOIQ9WRal4cpiFH4IUUeyGKMxFFeHDOpjiR8aK9iq0UVQ/K7o4h1x7odUVcORHZ0f5YOnNFWLRiqOzoxrZij8OxaoYooxaOmDFxohiMmTMXkWqiGIWhez0ey17FUOqv0V6Lw9D9EOc0IzUe6LRCihCq8nd02Wi0ZMjEP0UzEL0b+mTJkyZ+1aMxVo5ciY39EOoXo/TBicrhmDESqEOOCuPpj6JfRmL6OnahihaP24EYH5FgQwMSO6f/aAAwDAQACAAMAAAAQaS7bf/7fT3weexfbb/fbfbeTDff/AOnO09N+2G3+oIs53hFP2v8Ap/ttt8QLdN9/5vvtvtr/APwBy/8A282O22+t+3+9oNv338n2+3//ANP/AO0w2z/ffbbf437f/wCn0Au+2/2//wBtN/5Jx/CJ9/tftt7v/v8AbYfiG+f73eT7bb7faEfqy6be/wCu/wB/9/7pjsER9f5/9t9tvvtLZMTR7YLvPtt99tv9fsdr9/zh/t9rvvt9vsBt9t9tt9uZLJ7LAcZhJvv9TvPPfB57F9tpLtt//t8N9/8A6c7Tb/fbfbeTizneEU/a037Ybf6gC3Tff+b7/wCn+223xMv/ANvNjtvtvtr/APwB2/ffyfb7b637f72g2z/ffbbff/8A0/8A7TALvtv9v/8A437f/wCn0In3+1+23m03/knH8Bvn+93k++/+/wBth+LLpt7/AK7/AG2+32hH6hH1/n/233/3/umOwdHtgu8+222++0tkxGv3/OH+33322/1+x232322322u++32+wGEm+/1O85ksnssBxv/EABsRAAICAwEAAAAAAAAAAAAAAAEwABEgQFAQ/9oACAEDAQE/EPDAgqqD2pWpeyVHI+UoOPAKq1ahQNQcQ6xwOR4B4BUdAwbQ59aITbCm8DL8vMoEKqg9qUgwIPDv05HynFR0g4qrVqFA6gwPAOscDkeAVHoGDaD64xWE36UCFN4GX5eP/8QAGxEBAAEFAQAAAAAAAAAAAAAAAVARIDBgcED/2gAIAQIBAT8Q0cxEARVdsLDuBox5jERVeGFh1A8v/8QAHxABAQEBAQEBAQEAAwAAAAAAAQARITFBEFFhcYGh/9oACAEBAAE/EHjbpenbJrbTfZGRmw85LWBfL+zO1r2FkMv6kDtvGFNkWRZdlxvbI67Osla1GpLhkeWnix5HO26ewsMk7kHLOu3MC2BpY3tPNwXzye3zI/2eQEfAxewPbrQRx7HlvbbC/h9jpB17L1L1BodkN5eI85GiFtttsOdtNW7Pl03FxkM4XMT7k8WzjyPqE8kydMxxve2pdS2N9MPLYeSHyTtv6TkYGRT8D+wc5K02gi+xq8u7d3M/NdhQuXCHvL4/L0xNmGxmxjBJ7H8zjeyciMRy0bNthLvZjglhuy75Pu5a3tv4Pvy3l4eXkb1Kse/h9t5PrcG/ocJeWMJBxPEtHk9fL5Hu2tk4RAjD4tcj7f63W7Lhkdy3WyDVk7JgP4x8kvreI/kLkuXxKR/yB3J5En2Ulyzk0Zbf7Hu/g5DtuQTSH2eOsqheL/v8Dt4vsd/PMnMjL25UnYsbPe28h9LJuxPt62ckb5Az5cL2TVdjpD/C27Z4w0/PufZbeI6W4s1WfiDuwswpdBiPZ9gLu4QYuyI2ooY31sa7dteQdnjE+2pIBY2Gww9nyOjtjsm8z1OGz/fw4jhsx7DW2mWjsqWufJIvPwIMZY3vljyDkX+LByOP7ckz5HqQ95dYtx211PkNsvZOkmM+7f2X5brD26pt5Zzfx6yOk+Qf5D2HG3cv4S2Q9QxWh8t/8Lw8h/SyCb2fSXZ8n8Z/sO7LOS62T5aSD/yTpk+RxHUOaWor1DqXkRXdl9R7MFHJ97OhfMsd5AqbYR5fPL5n47sDLMnz8HLckgSrBWOG28zOSazRa8lzsLl2ejhJMM3BZ2Tu3WTgjpYDsuwNvIzZ6+x7yTNgnfIaR19h82HCCDuWO58vkJjpWGoaXj2x1imtp1D4u3tjLEg247b8tnlvZd9v6JWy8hwyXXCE3hD2/qLEX2GLTb1DEum/jIZ6Wd9vBvhPVspF/wB2USN72ysDSOPJPYS5t1xAzhIHbeMKbIsiy7Lje2R12dZK1qNSXDI8njbpenbJrbTfZGRmw85LWBfL+zO1r2FkMvnk9vmR/s8gI+Bi9ge3Wgjj2PLe22F/Gnix5HO26ewsMk7kHLOu3MC2BpY3tPNwT5dNxcZDOFzE+5PFs48j6hPJMnTMcZ9jpB17L1L1BodkN5eI85GiFtttsOdtNW7Kfgf2DnJWm0EX2NXl3bu5n5rsKFy4XvbUupbG+mHlsPJD5J239JyMDIjlo2bbCXezHBLDdl3yfdy1vbfwfflvLw8h7y+Py9MTZhsZsYwSex/M43snIjHiWjyevl8j3bWycIgRh8WuR9v9brdlwyO5eRvUqx7+H23k+twb+hwl5YwkHE/5A7k8iT7KS5ZyaMtv9j3fwch23LdbINWTsmA/jHyS+t4j+QuS5fEpPblSdixs97byH0sm7E+3rZyRvkE0h9njrKoXi/7/AAO3i+x388ycyMtxZqs/EHdhZhS6DEez7AXdwgxdkRtQGfLheyarsdIf4W3bPGGn59z7LbxHSOjtjsm8z1OGz/fw4jhsx7DW2mWjsqWufJQxvrY127a8g7PGJ9tSQCxsNhh7PkepD3l1i3HbXU+Q2y9k6SYz7t/ZflusPZIvPwIMZY3vljyDkX+LByOP7ckz5D1DFaHy3/wvDyH9LIJvZ9Jdnyfxn+w7t1Tbyzm/j1kdJ8g/yHsONu5fwlsld2X1HswUcn3s6F8yx3kCpthHl88vmfjuyzkutk+Wkg/8k6ZPkcR1DmlqK9Q6l5E7PRwkmGbgs7J3brJwR0sB2XYG3kZs9fY95AyzJ8/By3JIEqwVjhtvMzkms0WvJc7C5Y6xTW06h8Xb2xliQbcdt+Wzy3su+39ErZeSZsE75DSOvsPmw4QQdyx3Pl8hMdKw1DS8e2d9vBvhPVspF/3ZRI3vbKwNI48k9hLm3XEOGS64Qm8Ie39RYi+wxabeoYl038ZDPS//2Q=="}},t=>{t.O(0,[977],(()=>(413,t(t.s=413)))),t.O()}]);